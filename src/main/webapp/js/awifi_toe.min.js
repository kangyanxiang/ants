/** @Copyright 爱WiFi TOE项目组 @version v2016-11-1 21:15:56 */
var indexApp=angular.module("indexApp",["ngRoute","ui.bootstrap","ngFileUpload","ngDialog"]);indexApp.run(function($rootScope,$cacheFactory,permissionService){permissionService.getCurUserPermissionCode()});indexApp.factory("sessionInjector",["$q",function($q){var responseInterceptor={response:function(response){var deferred=$q.defer();if(response.status=="200"){if(response.data&&typeof response.data==="string"&&response.data.match(/login\.min\.js/m)){window.top.location.href="/logout"}}deferred.resolve(response);return deferred.promise}};return responseInterceptor}]);indexApp.config(["$httpProvider",function($httpProvider){if(!$httpProvider.defaults.headers.get){$httpProvider.defaults.headers.get={}}$httpProvider.defaults.headers.get["Cache-Control"]="no-cache";$httpProvider.defaults.headers.get["Pragma"]="no-cache";$httpProvider.interceptors.push("sessionInjector")}]);function getCurDate(){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var curDate=year+"-"+(month<10?"0"+month:month)+"-"+(day<10?"0"+day:day);return curDate}function getCurDateHour(){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var hour=date.getHours();var curDate=year+"-"+(month<10?"0"+month:month)+"-"+(day<10?"0"+day:day)+" "+(hour<10?"0"+hour:hour);return curDate}function getEarlyOfMonth(){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var curDate=year+"-"+(month<10?"0"+month:month)+"-"+"01";return curDate}jQuery(function($){$.datepicker.regional["zh-CN"]={clearText:"清除",clearStatus:"清除已选日期",closeText:"关闭",closeStatus:"不改变当前选择",prevText:"<上月",prevStatus:"显示上月",prevBigText:"<<",prevBigStatus:"显示上一年",nextText:"下月>",nextStatus:"显示下月",nextBigText:">>",nextBigStatus:"显示下一年",currentText:"今天",currentStatus:"显示本月",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],monthStatus:"选择月份",yearStatus:"选择年份",weekHeader:"周",weekStatus:"年内周次",dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],dayStatus:"设置 DD 为一周起始",dateStatus:"选择 m月 d日, DD",dateFormat:"yy-mm-dd",firstDay:1,initStatus:"请选择日期",isRTL:false,changeYear:true,changeMonth:true};$.datepicker.setDefaults($.datepicker.regional["zh-CN"])});var jDialog={_onEnd:null,_canClose:true,_tmr:null,show:function(options){this.hide();var _this=this;var defaults={content:"",width:400,height:68,title:"提示",scroll:0,okButton:1,okLabel:"确定",cancelButton:0,cancelLabel:"取消",onBegin:function(){},onEnd:function(){},onOK:function(){return true},onCancel:function(){return true}};var opts=$.extend(defaults,options);if(!document.getElementById("jDialog")){$("body").append('<div id="jDialog_Overlay"></div><div id="jDialog"><div id="jDialog-Title" class="jDialog-Title"><span></span><a href="javascript:;"></a></div><div class="jDialog-Container"></div><div class="jDialog-Buttons"><span></span></div></div>')}else{$("#jDialog_Overlay").show();$("#jDialog").show()}if(typeof opts.onBegin=="function")opts.onBegin();this.onEnd=typeof opts.onEnd=="function"?opts.onEnd:null;if(!opts.okButton&&!opts.cancelButton)$("#jDialog .jDialog-Buttons").hide();$("#jDialog .jDialog-Title span").html(opts.title);$("#jDialog .jDialog-Title a").click(this.hide);$("#jDialog .jDialog-Container").height(opts.height).html(opts.content);if(opts.scroll)$("#jDialog .jDialog-Container").addClass("Scroll");if(this._canClose){if(opts.okButton)$("#jDialog .jDialog-Buttons").append('<button class="jDialog-OK">'+opts.okLabel+"</button>");if(opts.cancelButton)$("#jDialog .jDialog-Buttons").append('<button class="jDialog-Cancel">'+opts.cancelLabel+"</button>");if(opts.otherButton)$("#jDialog .jDialog-Buttons").append('<button class="jDialog-Other">'+opts.otherLabel+"</button>")}var winWidth=$(window).width(),winHeight=$(window).height(),titleHeight=$("#jDialog .jDialog-Title").outerHeight(),btnHeight=$("#jDialog .jDialog-Buttons").outerHeight(),scrollTop=$(window).scrollTop();$("#jDialog").css({width:opts.width,height:opts.height+titleHeight+btnHeight,left:(winWidth-opts.width)/2,top:(winHeight-opts.height-titleHeight-btnHeight)/2+scrollTop});$("#jDialog-Title a").click(function(){if(opts.onCancel())_this.hide()});$("#jDialog .jDialog-Buttons button:first").focus();$("#jDialog .jDialog-Buttons button.jDialog-OK").click(function(){if(opts.onOK())_this.hide()});$("#jDialog .jDialog-Buttons button.jDialog-Cancel").click(function(){if(opts.onCancel())_this.hide()})},addButton:function(btn,cls,fun){var _this=this;$("#jDialog .jDialog-Buttons").append('<button class="jDialog-'+cls+'">'+btn+"</button>");$("#jDialog .jDialog-Buttons button.jDialog-"+cls).click(function(){if(fun())_this.hide()})},message:function(str){clearTimeout(this._tmr);$("#jDialog .jDialog-Buttons span").html(str);this._tmr=setTimeout(function(){$("#jDialog .jDialog-Buttons span").html("")},5e3)},alert:function(title,str,fun){this.show({title:title,content:'<span class="jDialog-Text">'+str+"</span>"});if(typeof fun=="function")fun()},confirm:function(title,str,fun){this.show({title:title,content:'<span class="jDialog-Text">'+str+"</span>",cancelButton:1,onOK:fun})},openform:function(title,url,width,height,fun){this.show({title:title,scroll:1,content:'<div class="loading"></div>',width:width,height:height,cancelButton:1,onOK:fun});$.ajax({type:"GET",url:url,dataType:"html",success:function(data){$("#jDialog .jDialog-Container").html('<div class="winpage">'+data+"</div>")},error:function(){$("#jDialog .jDialog-Container").html('<div class="loadfailed">加载页面失败</div>')}})},openurl:function(title,url,width,height){this.show({title:title,scroll:1,content:'<div class="loading"></div>',width:width,height:height});$.ajax({type:"GET",url:url,dataType:"html",success:function(data){$("#jDialog .jDialog-Container").html('<div class="winpage">'+data+"</div>")},error:function(){$("#jDialog .jDialog-Container").html('<div class="loadfailed">加载页面失败</div>')}})},openhtmlform:function(title,htmlcode,width,height,fun){this.show({title:title,scroll:1,content:'<div class="winpage">'+htmlcode+"</div>",width:width,height:height,cancelButton:1,onOK:fun})},openhtml:function(title,htmlcode,width,height){this.show({title:title,scroll:1,content:'<div class="winpage">'+htmlcode+"</div>",width:width,height:height})},openhtmlcb:function(title,htmlcode,width,height){this.show({title:title,scroll:1,content:'<div class="winpage">'+htmlcode+"</div>",width:width,height:height,cancelButton:1,okButton:0})},hide:function(){if(this._canClose){$("#jDialog .jDialog-Container").html("").removeClass("Scroll");$("#jDialog .jDialog-Buttons").html("<span></span>");$("#jDialog").hide();$("#jDialog_Overlay").hide();if(typeof this.onEnd=="function")this.onEnd()}}};function initTips($obj,message){$obj.poshytip({content:message,className:"tip-yellow",showOn:"none",bgImageFrameSize:9,alignTo:"target",alignX:"inner-left",offsetX:0,offsetY:20});$obj.bind("focus",function(){hideTips($obj)})}function initTipsArray(objArray){var maxLength=objArray.length;for(var i=0;i<maxLength;i++){initTips(objArray[i])}}function showTips($obj){$obj.poshytip("show")}function updateShowTipos($obj,message){updateTips($obj,message);showTips($obj);setTimeout(function(){hideTips($obj)},3e3)}function hideTips($obj){$obj.poshytip("hide")}function updateTips($obj,message){$obj.poshytip("update",message)}function destroyTips($obj){$obj.poshytip("destroy")}function destroyTipsArray(objArray){var maxLength=objArray.length;for(var i=0;i<maxLength;i++){destroyTips(objArray[i])}}function loadingAppend(){$("body").append('<div class="loadingBody">'+'<div class="loadingBg"></div>'+'<div class="closeBtn">x</div>'+'<div class="loadingInfo">'+'<div class="imgInfo">'+'<img src="images/loading.gif" alt="">'+"</div>"+"</div>"+"</div>");var height=$(window).height();var imgHeight=$(".imgInfo").height();$(".imgInfo").css("margin-top",(height-imgHeight)/2);$(".closeBtn").on("click",function(e){loadingRemove()})}function loadingRemove(){$(".loadingBody").remove()}function resetWidth(){var h=$(".datacontent");var width=h.outerWidth(true);$(".listtitle").css("width",width)}function defaultIfEmpty(str,defaultStr){if(str===null||str===undefined)str=defaultStr;return str}function defaultString(str){if(str===null||str===undefined)str="";return str}function isBlank(str){if(str===null||str===undefined||$.trim(str)==="")return true;return false}function isNotBlank(str){if(str===null||str===undefined||$.trim(str)==="")return false;return true}function isNull(str){if(str===null||str===undefined)return true;return false}var defrules={customerName:"^[0-9a-zA-Z一-龥_(),.（），。@]{1,50}$",account:"^[0-9a-zA-Z_]{4,20}$",contact:"^[a-zA-Z一-龥]{1,20}$",contactNew:"^[a-zA-Z一-龥]{0,20}$",contactWay:"^(1[3|4|5|7|8][0-9][0-9]{8})?$",projectName:"^[0-9a-zA-Z一-龥_]{1,50}$",userName:"^[0-9a-zA-Z-_]{1,50}$",cellphone:"^(1[0-9]{10})?$",realName:"^[a-zA-Z一-龥]{1,20}$",deptName:"^[0-9a-zA-Z一-龥]{1,20}$",newPwd:"^[^一-龥]{4,20}$",qNewPwd:"^[^一-龥]{4,20}$",wifiPlatformName:"^[0-9a-zA-Z一-龥_]{1,50}$",portalStrategyName:"^[0-9a-zA-Z一-龥_]{1,50}$",wifiProjectName:"^[0-9a-zA-Z一-龥_]{1,50}$",passwordNew:"^[0-9a-zA-Z_@$-]{1,50}$",passport:"^[0-9a-zA-Z]{1,20}$",identityCard:"^[0-9]{17}([0-9]|X){1}$",typeCode:"^[0-9a-zA-Z]{1,20}$",domain:"^[a-z0-9]{1,}([-.]{1}[a-z0-9]{1,}){0,}[.]{1}[a-z]{1,4}$",email:"^[a-z0-9_.]{1,}@[a-z0-9]{1,}([-.]{1}[a-z0-9]{1,}){0,}[.]{1}[a-z]{1,4}$",password:"^[0-9a-zA-Z_一-龥]{4,20}$",chinese:"^[一-龥]{0,}$",wchars:"^[^\0-ÿ]{0,}$",phone:"^(([0-9]{3,4}[-]{1})?[0-9]{7,8})?$",zip:"^([1-9][0-9]{5})?$",integer:"^([-]?[0-9]+)?$",positiveInteger:"^(0|[1-9][0-9]*)$",number:"^([-]?[0-9]{1,}([.][0-9]{1,})?)?$",idcard:"^([1-9]{1}[0-9]{14}([0-9]{2}[0-9x])?)?$",industryName:"^[A-Za-z一-龥]{1,20}$",orderNo:"^[0-9]*$",atlas:"^[0-9a-zA-Z_一-龥]{1,50}$",contactPer:"^[a-zA-Z_一-龥]{1,20}$"};function chkString(str,pattern){var re=new RegExp(pattern,"gi");return re.test(str)}function chkStringNew(str,pattern){var re=new RegExp(pattern);return re.test(str)}function checkLengthFail(str,length){if(str.length>length){return true}else{return false}}indexApp.controller("pageBarController",function($scope,pageService){});indexApp.factory("pageDao",function($http,$compile){var dao={};var initPageNo=function($scope,pageNo,totalPage){var html="";html+="<ul>";if(pageNo!=1){html+='<li class="pre_page">上一页</li>'}var maxPreNo=5;var hasPreNo=totalPage>8&&pageNo>maxPreNo;var maxSuffixNo=totalPage-3;var hasSuffixNo=totalPage>8&&pageNo<maxSuffixNo;if(hasPreNo&&!hasSuffixNo){html+='<li class="page_one">1</li>';html+='<li id="pn-break">…</li>';var startIndex=totalPage-6;for(var i=startIndex;i<=totalPage;i++){if(i<=0)continue;html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}}else if(hasPreNo&&hasSuffixNo){html+='<li class="page_one">1</li>';html+='<li id="pn-break">…</li>';var startIndex=pageNo-3;var endIndex=pageNo+2;for(var i=startIndex;i<=endIndex;i++){if(i<=0)continue;html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}html+='<li id="pn-break">…</li>';html+='<li class="page_one">'+totalPage+"</li>"}else if(!hasPreNo&&hasSuffixNo){var maxSize=maxPreNo+2;for(var i=1;i<=maxSize;i++){html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}html+='<li id="pn-break">…</li>';html+='<li class="page_one">'+totalPage+"</li>"}else if(!hasPreNo&&!hasSuffixNo){for(var i=1;i<=totalPage;i++){html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}}var lastPageNo=totalPage-1;if(pageNo!=totalPage&&pageNo!=totalPage){html+='<li class="next_page">下一页</li>'}html+="</ul>";var $pageNoBar=$(".right_footer_page");$pageNoBar.empty().append(html)};var initPageNum=function(pageSize){$(".show_page").each(function(){var $this=$(this);var num=$this.attr("value");if(num==pageSize){$this.attr("id","page_selected")}})};var bindPageEvent=function($scope){var $pageNoBar=$(".right_footer_page");$pageNoBar.find(".pre_page").bind("click",function(){var $curPageNo=$pageNoBar.find("#page_selected");var $prevPageNo=$curPageNo.prev();var prePageNo=$prevPageNo.text();if(prePageNo==="上一页"){return}$curPageNo.attr("id","");$prevPageNo.attr("id","page_selected");$scope.list()});$pageNoBar.find(".page_one").bind("click",function(){$pageNoBar.find("#page_selected").attr("id","");var $this=$(this);$this.attr("id","page_selected");$scope.list()});$pageNoBar.find(".next_page").bind("click",function(){var $curPageNo=$pageNoBar.find("#page_selected");var $nextPageNo=$curPageNo.next();var nextPageNo=$nextPageNo.text();if(nextPageNo==="下一页"){return}$curPageNo.attr("id","");$nextPageNo.attr("id","page_selected");$scope.list()});var $pageNumBar=$(".page_num");var $show_page=$pageNumBar.find(".show_page");$show_page.off();$show_page.on("click",function(){$pageNumBar.find("#page_selected").attr("id","");var $this=$(this);$this.attr("id","page_selected");var paramKey="page.pageSize";var paramValue=$this.val();var url="/sysconfig/setvaluebykey?paramKey="+paramKey+"&paramValue="+paramValue;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert(data.message);return}$scope.list()}).error(function(data,status,headers,config){})})};dao.getPageNo=function(){var pageNo=$('.right_footer_page  li[id="page_selected"]').text();if(pageNo===null||pageNo===undefined||$.trim(pageNo)==="")pageNo=1;return pageNo};dao.init=function($scope,data){var pageNo=data.pageNo;var totalPage=data.totalPage;var pageSize=data.pageSize;var totalRecord=data.totalRecord;$scope.showPageBar=totalRecord>0?true:false;initPageNo($scope,pageNo,totalPage);initPageNum(pageSize);bindPageEvent($scope)};dao.changePageSize=function($scope,callback){var $show_page=$("#page_num2 .show_page");$show_page.off().on("click",function(){$scope.pageNo2=1;$show_page.removeProp("id");var $this=$(this);$this.prop("id","page_selected");var paramKey="page.pageSize";var paramValue=$this.val();var url="/sysconfig/setvaluebykey?paramKey="+paramKey+"&paramValue="+paramValue;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert(data.message);return}callback()}).error(function(data,status,headers,config){})})};dao.pageTips=function($scope){var $show_page=$("#page_num2 .show_page");$show_page.each(function(){var $this=$(this);if($this.val()==$scope.pageSize2.toString()){$this.prop("id","page_selected")}});$("#page_tips").html("第"+$scope.pageNo2+"页/共"+$scope.pageTotal2+"页 共总"+$scope.rowTotal2+"条")};dao.pageBindEvent=function($scope,callback){var that=this;$(".pre_page2").off().click(function(){if($scope.pageNo2<=1){jDialog.alert("提示","没有上一页了");return}else{$scope.pageNo2-=1;callback();that.pageTips($scope)}});$(".next_page2").off().click(function(){if($scope.pageNo2>=$scope.pageTotal2){jDialog.alert("提示","没有下一页了");return}else{$scope.pageNo2+=1;callback();that.pageTips($scope)}})};dao.dialogPageInit=function($scope,data,callback){$scope.rowTotal2=data.totalRecord;$scope.pageSize2=data.pageSize;$scope.pageTotal2=Math.ceil($scope.rowTotal2/$scope.pageSize2);$scope.showPageBar2=$scope.rowTotal2>0?true:false;this.changePageSize($scope,callback);this.pageBindEvent($scope,callback);this.pageTips($scope)};return dao});indexApp.factory("pageService",function(pageDao){var service={};return service});indexApp.factory("leftMenuDao",function($http,$cacheFactory){var dao={};return dao});indexApp.controller("leftMenuController",function($scope,leftMenuService){$scope.selectMenu=function($event){leftMenuService.selectMenu($event)};$scope.sysSet=function($event){leftMenuService.sysSet($event)};function initMenu(){var $nav=$(".nav");$nav.find(".nav-sub a").on("click",function(e){var $item=$(this);$nav.find(".nav-sub a.active").removeClass("active");if(!$item.hasClass("active")){$item.addClass("active")}});$nav.find(".branch").on("click",function(e){var $item=$(this);var $item_siblings=$item.siblings(".active");$item_siblings.removeClass("active");$item_siblings.find("ul").slideUp();$item.addClass("active");var $nav_sub=$item.find("ul");$nav_sub.slideDown()});$(".header .header-user").on("click",function(e){e.stopPropagation();var $profile=$(".header-profile");if($profile.height()===0){$profile.css("height",$profile.find("ul").outerHeight());$(document).on("click",hideProfile)}else{$profile.css("height",0)}});$(window).on("resize",function(e){$(".main-layout").height($("body").height()-$(".header").height()-$(".nav-map").height())}).trigger("resize");$("[lhref]").on("click",function(e){});$(".header-profile").on("click","a",function(e){$(".header-profile").css("height",0);$(".active").removeClass("active")});$(".header-profile").on("mouseleave",function(e){$(this).css("height",0)})}var hideProfile=function(e){if($(e.target).parents(".header-profile").length===0){$(document).off("click",hideProfile);$(".header-profile").css("height",0)}};function leftNavHeight(){var windowHeight=$("body").height();$(".nav-wrap").css({height:windowHeight-60+"px"})}function enterEvent(){$("body").keydown(function(event){if(event.keyCode===13){var search_button=$(".awifi-form-sheet button").eq(0);if(search_button){search_button.click()}}})}function init(){initMenu();leftNavHeight();enterEvent()}init()});indexApp.factory("leftMenuService",function(leftMenuDao){var service={};service.initLeftMenu=function(){$("#project_menu").click(function(){$("#project_ul").toggle();if($("#project_ul").css("display")=="none"){$("#img01").attr("src","../../../../images/arrow_d.png")}else{$("#img01").attr("src","../../../../images/arrow_u.png")}})};service.selectMenu=function($event){var $choosed=$($event.target);$(".project_menu .menu_selected").removeClass("menu_selected");$choosed.addClass("menu_selected")};service.sysSet=function($even){$("#sys_ul").toggle();if($("#sys_ul").css("display")=="none"){$("#img02").attr("src","../../../../images/arrow_d.png")}else{$("#img02").attr("src","../../../../images/arrow_u.png")}};return service});indexApp.factory("permissionDao",function($http,$cacheFactory){var dao={};dao.getCurUserPermissionCode=function(){var url="/permission/getcuruserpermissioncode";var codeData={};$.ajax({type:"get",url:url,cache:false,async:false,dataType:"json",success:function(data){codeData.codes=data.data;codeData.userType=data.userType}});return codeData};return dao});indexApp.controller("permissionController",function($scope,permissionService){});indexApp.factory("permissionService",function(permissionDao,$cacheFactory){var service={};service.getCurUserPermissionCode=function(){var permissionCache=$cacheFactory("permissionCache");var codes=permissionDao.getCurUserPermissionCode();permissionCache.put("codes",codes)};return service});indexApp.controller("topMenuController",function($scope,topMenuService){topMenuService.getCurUserName($scope)});indexApp.factory("topMenuDao",function($http){var dao={};dao.getCurUserName=function($scope){var url="/user/getcurusername";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}var userName=data.userName;if(isBlank(userName)){}$scope.userName=userName})};return dao});indexApp.factory("topMenuService",function(topMenuDao){var service={};service.getCurUserName=function($scope){topMenuDao.getCurUserName($scope)};return service});indexApp.controller("accountAddController",function($scope,accountService,locationService){function validateFail($scope){if(accountService.validateAccountUserNameFail($scope)){return true}if(accountService.validateAccountRoleIdFail($scope)){return true}if(accountService.validateAccountProvinceIdFail($scope)){return true}if(accountService.validateAccountCityAreaByRoleFail($scope)){return true}if(accountService.validateAccountContactPersonFail($scope)){return true}if(accountService.validateAccountContactWayFail($scope)){return true}if(accountService.validateAccountRemarkFail($scope)){return true}return false}$scope.cityChange=function($event){var provinceId=defaultString($scope.account.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.account.cityId);locationService.countyList($scope,cityId)};$scope.roleChange=function($event){var roleId=$scope.account.roleId;if(roleId=="6"){$("#areaSelect").hide()}else{$("#areaSelect").show()}};$scope.add=function(){if(validateFail($scope)){return}var projectId=$scope.account.projectId;if(projectId==null){jDialog.alert("添加账号:","项目名称不能为空");return}accountService.add($scope)};function init(){$scope.account={};accountService.projectList($scope);accountService.roleList($scope);accountService.initTipsForAddTelecomAccountChange();locationService.provinceList($scope)}init()});indexApp.controller("accountAdminAddController",function($scope,accountService){function validateFail($scope){if(accountService.validateAccountUserNameForAdminFail($scope)){return true}if(accountService.validateAccountDeptNameForAdminFail($scope)){return true}if(accountService.validateAccountContactPersonForAdminFail($scope)){return true}if(accountService.validateAccountContactWayForAdminFail($scope)){return true}if(accountService.validateAccountRemarkForAdminFail($scope)){return true}return false}$scope.adminAdd=function(){if(validateFail($scope)){return}accountService.adminAdd($scope)};function init(){$scope.account={};accountService.initTipsForAddAdminCountChange()}init()});indexApp.controller("accountAdminEditController",function($scope,$location,accountService,locationService){function validateFail($scope){if(accountService.validateAccountDeptNameForAdminFail($scope)){return true}if(accountService.validateAccountContactPersonForAdminFail($scope)){return true}if(accountService.validateAccountContactWayForAdminFail($scope)){return true}if(accountService.validateAccountRemarkForAdminFail($scope)){return true}return false}$scope.adminEdit=function(){if(validateFail($scope)){return}accountService.adminEdit($scope)};function init(){var id=$location.search()["id"];accountService.projectList($scope);accountService.getAccountAdminById($scope,id);accountService.initTipsForAddAdminCountChange()}init()});indexApp.controller("accountAdminListController",function($scope,accountService){function list(){accountService.adminList($scope)}$scope.list=list;list();$scope.delete=function(id){jDialog.confirm("删除管理员账号",'<div class="rows"><label class="w100">您确定删除该管理员账号吗？</label></div>',function(){accountService.delete($scope,id);jDialog.hide()})};$scope.pwdReset=function(id){jDialog.confirm("密码重置",'<div class="rows"><label class="w100">您确定要将该账号的密码重置吗？</label></div>',function(){accountService.pwdReset($scope,id);jDialog.hide()})};resetWidth()});indexApp.controller("accountCustomerListController",function($scope,accountService,customerService){$scope.pwdReset=function(id){jDialog.confirm("密码重置",'<div class="rows"><label class="w100">您确定要将该账号的密码重置吗？</label></div>',function(){accountService.pwdReset($scope,id);jDialog.hide()})};function list(){accountService.customerList($scope)}$scope.list=list;list();resetWidth();function init(){customerService.customerSelect2("customerName")}init()});indexApp.controller("accountEditController",function($scope,$location,accountService){function validateFail($scope){if(accountService.validateAccountContactPersonFail($scope)){return true}if(accountService.validateAccountContactWayFail($scope)){return true}if(accountService.validateAccountRemarkFail($scope)){return true}return false}$scope.edit=function(){if(validateFail($scope)){return}var projectId=$scope.account.projectId;if(projectId==null){jDialog.alert("编辑账号:","项目名称不能为空");return}accountService.edit($scope)};function init(){var id=$location.search()["id"];accountService.projectList($scope);accountService.getAccountById($scope,id);accountService.initTipsForAddTelecomAccountChange()}init()});indexApp.controller("accountInfoModifyController",function($scope,$location,accountService){function validateFail($scope){if(accountService.validateContactPersonFail($scope)){return true}if(accountService.validateContactWayFail($scope)){return true}return false}$scope.infoModify=function(){if(validateFail($scope)){return}accountService.infoModify($scope)};function init(){accountService.getCurUserInfo($scope);accountService.initTipsForPersonMobileChange()}init()});indexApp.controller("accountTelecomListController",function($scope,accountService,locationService){function list(){accountService.list($scope)}$scope.list=list;list();$scope.delete=function(id){jDialog.confirm("删除账号",'<div class="rows"><label class="w100">您确定要删除该账号吗？</label></div>',function(){accountService.delete($scope,id);jDialog.hide()})};$scope.pwdReset=function(id){jDialog.confirm("密码重置",'<div class="rows"><label class="w100">您确定要将该账号的密码重置吗？</label></div>',function(){accountService.pwdReset($scope,id);jDialog.hide()})};$scope.cityChange=function($event){var provinceId=defaultString($scope.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.cityId);locationService.countyList($scope,cityId)};function init(){accountService.roleList($scope);locationService.provinceList($scope)}init();resetWidth()});indexApp.controller("permissionAssignCustomerController",function($scope,$location,accountService){$scope.permissionAssign=function(){accountService.permissionAssign($scope)};function init(){var id=$location.search()["id"];var userName=$location.search()["userName"];var customerName=$location.search()["customerName"];$scope.id=id;$scope.userName=userName;$scope.customerName=customerName;accountService.getAccountById($scope,id);accountService.getPermission($scope)}init()});indexApp.controller("permissionAssignTelecomController",function($scope,$location,accountService){$scope.permissionAssign=function(){accountService.permissionAssign($scope)};function init(){var id=$location.search()["id"];$scope.id=id;accountService.getAccountById($scope,id);accountService.getPermission($scope)}init()});indexApp.controller("pwdEditController",function($scope,$location,accountService){function validateFail($scope){if(accountService.validateOldPasswordFail($scope)){return true}if(accountService.validateNewPasswordFail($scope)){return true}if(accountService.validateSurePasswordFail($scope)){return true}return false}$scope.pwdEdit=function(){if(validateFail($scope)){return}accountService.pwdEdit($scope)};function init(){accountService.getCurUserInfo($scope);accountService.initTipsForPwdChange()}init()});indexApp.factory("accountDao",function($http,$location,pageDao){var dao={};dao.getCurUserInfo=function($scope){var url="/user/getcuruserinfo";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.account=data.data})};dao.pwdEdit=function($scope){var oldPassword=$scope.oldPassword;var newPassWord=$scope.newPassword;var surePassword=$scope.surePassword;var url="/account/pwdedit?oldPassword="+oldPassword+"&newPassword="+newPassWord+"&qpassword="+surePassword;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.confirm("修改账号密码",'<div class="rows"><label class="w100">密码修改成功</label></div>',function(){window.top.location.href="/logout";jDialog.hide()})})};dao.infoModify=function($scope){$("#accountInfoModify").attr("disabled",true);var contactPerson=defaultString($scope.account.contactPerson);var contactWay=defaultString($scope.account.contactWay);contactPerson=encodeURIComponent(contactPerson);var url="/account/infomodify?contactPerson="+contactPerson+"&contactWay="+contactWay;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);$("#accountInfoModify").removeAttr("disabled");return}jDialog.alert("修改账号基本信息","修改成功");$location.path("/")})};dao.delete=function($scope,id){var url="/account/delete?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.alert("账号删除：","删除成功！");$scope.list()})};dao.pwdReset=function($scope,id){$("#pwdEdit").attr("disabled",true);var url="/account/pwdreset?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);$("#pwdEdit").removeAttr("disabled");return}var defaultPassword=data.defaultPassword;jDialog.alert("账号密码重置:","密码重置成功，新密码是："+defaultPassword)})};dao.customerList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var account=defaultString($scope.account);var params={pageNo:pageNo,keywords:keywords,account:account};var url="/accountcustomer/list?"+$.param(params);$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.customerAccounts=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.list=function($scope){var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var roleId=$scope.roleId;var provinceId=$scope.provinceId;var cityId=$scope.cityId;var areaId=$scope.areaId;if(isBlank(roleId)){roleId=""}if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(areaId)){areaId=""}var url="/account/list?pageNo="+pageNo+"&keywords="+keywords+"&roleId="+roleId+"&provinceId="+provinceId+"&cityId="+cityId+"&areaId="+areaId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}accounts=data.records;$scope.accounts=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.roleList=function($scope){var url="/account/rolelist";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.roles=data.data})};dao.projectList=function($scope){var url="/project/projectlist";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.projects=data.data})};dao.add=function($scope){$("#accountAdd").attr("disabled",true);var userName=defaultString($scope.account.userName);var roleId=$scope.account.roleId;var provinceId=$scope.account.provinceId;var projectId=$scope.account.projectId;var cityId=$scope.account.cityId;var areaId=$scope.account.areaId;var contactPerson=defaultString($scope.account.contactPerson);var contactWay=defaultString($scope.account.contactWay);var remark=defaultString($scope.account.remark);contactPerson=encodeURIComponent(contactPerson);remark=encodeURIComponent(remark);if(isBlank(roleId)){roleId=""}if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(areaId)){areaId=""}if(isBlank(remark)){remark=""}if(roleId=="6"){provinceId="";cityId="";areaId=""}var url="/account/add?userName="+userName+"&userType="+roleId+"&fkProjectId="+projectId+"&provinceId="+provinceId+"&cityId="+cityId+"&areaId="+areaId+"&contactPerson="+contactPerson+"&contactWay="+contactWay+"&remark="+remark;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);$("#accountAdd").removeAttr("disabled");return}var defaultPassword=data.defaultPassword;jDialog.alert("添加账号（电信侧）:","添加成功，账号是："+userName+"，密码是："+defaultPassword);$location.path("account/telecomList")})};dao.getAccountById=function($scope,id){var url="/account/show?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.account=data.data})};dao.edit=function($scope){$("#accountEdit").attr("disabled",true);var id=$scope.account.id;var contactPerson=defaultString($scope.account.contactPerson);var contactWay=defaultString($scope.account.contactWay);var remark=defaultString($scope.account.remark);
var projectId=$scope.account.projectId;if(isBlank(remark)){remark=""}var url="/account/edit?id="+id+"&projectId="+projectId+"&contactPerson="+contactPerson+"&contactWay="+contactWay+"&remark="+remark;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);$("#accountEdit").removeAttr("disabled");return}jDialog.alert("编辑账号（电信侧）:","账号信息编辑成功");$location.path("account/telecomList")})};dao.getPermissionById=function($scope,id){var url="account/showpermission?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.rightpermissions=data.data})};dao.getPermission=function($scope){var url="account/getpermissionlist";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.permissions=data.data;dao.getExistPermission($scope)})};dao.getExistPermission=function($scope){loadingAppend();var id=$scope.id;var url="account/showpermission?id="+id;$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}var existPermission=data.data;var _PSS_=existPermission.split(",");if(isBlank(existPermission)){_PSS_=[]}$scope._PSS_=_PSS_;var $pss=$(".jsd-origin");for(var i=0;i<_PSS_.length;i++){var $el=$pss.find("[mid="+_PSS_[i]+"]");$el.addClass("gave")}$(".jsd-gave").empty().html($pss.html());bindEvent()})};function bindEvent(){$(".jsd-origin").on("click",".leaf:not(.gave)",function(e){var $el=$(this);$el.addClass("gave");if($el.hasClass("limb")){$el.next().find(".leaf").addClass("gave")}var $pel=$el.parent();var pleaf;if($pel.is(".leafs")){pleaf=$pel.prev(".leaf");pleaf.addClass("gave");if(pleaf.parents(".leafs")){pleaf.parents(".leafs").prev().addClass("gave")}}else if($pel.is(".nothingleaf")){pleaf=$pel.parents(".leafs");pleaf.prev().addClass("gave")}$(".jsd-gave").empty().html($(".jsd-origin").html())});$(".jsd-gave").on("click",".gave",function(e){var $el=$(this);$el.removeClass("gave");if($el.hasClass("limb")){$el.next().find(".leaf").removeClass("gave")}var $pel=$el.parent();if($pel.parent().is(".leafs")&&$pel.parent().find(".gave").length===0){$pel.parent().prev().removeClass("gave");if($pel.parent().is(".leafs")&&$pel.parent().find(".gave").length===0){$pel.parent().prev().removeClass("gave")}}$(".jsd-origin").empty().html($(".jsd-gave").html())})}dao.permissionAssign=function($scope){loadingAppend();$("#submit").attr("disabled",true);var pss=[];var $pss=$(".jsd-gave .leaf.gave");for(var i=0;i<$pss.length;i++){pss.push($pss.eq(i).attr("mid"))}var pssstr="|"+pss.join("|")+"|";var flag=false;for(var j=0;j<$scope._PSS_.length;j++){if(pssstr.indexOf("|"+$scope._PSS_[j]+"|")<0){flag=true;break}}var userType=$scope.account.userType;var permissionIds=pss.join(",");var id=$scope.account.id;var url="account/assign?id="+id+"&permissionIds="+permissionIds;$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);$("#submit").removeAttr("disabled");return}jDialog.alert("分配权限","该账号权限分配成功");if(userType==2||userType==3||userType==4||userType==6){$location.path("account/telecomList")}else if(userType==1){$location.path("account/adminList")}else{$location.path("account/customerList")}}).error(function(data,status,headers,config){})};dao.adminList=function($scope){var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var url="accountadmin/list?pageNo="+pageNo+"&keywords="+keywords;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}accountadmins=data.records;$scope.accountadmins=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.adminAdd=function($scope){$("#adminAdd").attr("disabled",true);var userName=encodeURIComponent(defaultString($scope.account.userName));var deptName=encodeURIComponent(defaultString($scope.account.deptName));var contactPerson=encodeURIComponent(defaultString($scope.account.contactPerson));var contactWay=encodeURIComponent(defaultString($scope.account.contactWay));var remark=encodeURIComponent(defaultString($scope.account.remark));var url="/accountadmin/add?userName="+userName+"&deptName="+deptName+"&contactPerson="+contactPerson+"&contactWay="+contactWay+"&remark="+remark;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);$("#adminAdd").removeAttr("disabled");return}var defaultPassword=data.defaultPassword;jDialog.alert("创建账号:","创建成功，账号是："+userName+"，密码是："+defaultPassword);$location.path("account/adminList")})};dao.getAccountAdminById=function($scope,id){var url="/accountadmin/show?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.account=data.data})};dao.adminEdit=function($scope){$("#adminEdit").attr("disabled",true);var id=$scope.account.id;var deptName=encodeURIComponent(defaultString($scope.account.deptName));var contactPerson=encodeURIComponent(defaultString($scope.account.contactPerson));var contactWay=encodeURIComponent(defaultString($scope.account.contactWay));var remark=encodeURIComponent(defaultString($scope.account.remark));var url="/accountadmin/edit?id="+id+"&deptName="+deptName+"&contactPerson="+contactPerson+"&contactWay="+contactWay+"&remark="+remark;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);$("#adminEdit").removeAttr("disabled");return}jDialog.alert("编辑管理员账号:","账号信息编辑成功");$location.path("account/adminList")})};return dao});indexApp.factory("accountService",function($rootScope,accountDao){var service={};service.validateOldPasswordFail=function($scope){var $oldPassword=$("#oldPassword");var oldPassword=$scope.oldPassword;if(isBlank(oldPassword)){updateShowTipos($oldPassword,"旧密码不能为空！");return true}return false};service.validateNewPasswordFail=function($scope){var $newPassword=$("#newPassword");var oldPassword=$scope.oldPassword;var newPassword=$scope.newPassword;if(isBlank(newPassword)){updateShowTipos($newPassword,"新密码不能为空！");return true}if(!chkString(newPassword,defrules.passwordNew)){updateShowTipos($newPassword,"密码必须由1-50位字符组成，包含字母、数字、下划线、连接符、@、$");return true}if(newPassword==oldPassword){updateShowTipos($newPassword,"新密码与旧密码不能相同，请重新输入新密码！");return true}return false};service.validateSurePasswordFail=function($scope){var $surePassword=$("#surePassword");var newPassword=$scope.newPassword;var surePassword=$scope.surePassword;if(isBlank(surePassword)){updateShowTipos($surePassword,"确认密码不能为空！");return true}if(!chkString(surePassword,defrules.passwordNew)){updateShowTipos($surePassword,"密码必须由1-50位字符组成，包含字母、数字、下划线、连接符、@、$");return true}if($.trim(newPassword)!=$.trim(surePassword)){updateShowTipos($surePassword,"确认密码与新密码不一致，请重新输入！");return true}return false};service.initTipsForPwdChange=function(){var $oldPassword=$("#oldPassword");var $newPassword=$("#newPassword");var $surePassword=$("#surePassword");initTipsArray([$oldPassword,$newPassword,$surePassword]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$oldPassword,$newPassword,$surePassword])})};service.validateContactPersonFail=function($scope){var $contactPerson=$("#contactPerson");var contactPerson=$scope.account.contactPerson;if(!chkString(contactPerson,defrules.contact)){updateShowTipos($contactPerson,"联系人格式为：1-20位汉字、字母，不含特殊字符！");return true}return false};service.validateContactWayFail=function($scope){var $contactWay=$("#contactWay");var contactWay=$scope.account.contactWay;if(!chkString(contactWay,defrules.cellphone)){updateShowTipos($contactWay,"联系方式为手机号，格式为：11位以1开头的符合手机号码规则的数字");return true}return false};service.initTipsForPersonMobileChange=function(){var $contactPerson=$("#contactPerson");var $contactWay=$("#contactWay");initTipsArray([$contactPerson,$contactWay]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$contactPerson,$contactWay])})};service.validateAccountUserNameFail=function($scope){var $userName=$("#userName");var userName=$scope.account.userName;if(isBlank(userName)){updateShowTipos($userName,"账号名称不能为空！");return true}if(!chkString(userName,defrules.userName)){updateShowTipos($userName,"账号的格式为：1-50位字母、数字、下划线、连接符组成");return true}return false};service.validateAccountRoleIdFail=function($scope){var $roleId=$("#roleId");var roleId=$scope.account.roleId;if(isBlank(roleId)){updateShowTipos($roleId,"请选择一个角色");return true}return false};service.validateAccountProvinceIdFail=function($scope){var roleId=$scope.account.roleId;var $provinceId=$("#provinceId");var provinceId=$scope.account.provinceId;if(roleId=="2"||roleId=="3"||roleId=="4"){if(isBlank(provinceId)){updateShowTipos($provinceId,"请选择一个省");return true}}return false};service.validateAccountCityAreaByRoleFail=function($scope){var roleId=$scope.account.roleId;if(roleId=="3"){var $cityId=$("#cityId");var cityId=$scope.account.cityId;if(isBlank(cityId)){updateShowTipos($cityId,"请选择一个市");return true}return false}else if(roleId=="4"){var $areaId=$("#areaId");var areaId=$scope.account.areaId;if(isBlank(areaId)){updateShowTipos($areaId,"请选择一个区（县）");return true}return false}return false};service.validateAccountContactPersonFail=function($scope){var $contactPerson=$("#contactPerson");var contactPerson=$scope.account.contactPerson;if(isBlank(contactPerson)){updateShowTipos($contactPerson,"联系人信息不允许为空");return true}if(!chkString(contactPerson,defrules.contact)){updateShowTipos($contactPerson,"联系人的格式为：1-20位汉字、字母，不含特殊字符！");return true}return false};service.validateAccountContactWayFail=function($scope){var $contactWay=$("#contactWay");var contactWay=$scope.account.contactWay;if(!chkString(contactWay,defrules.cellphone)){updateShowTipos($contactWay,"联系方式为手机号，格式为：11位以1开头的符合手机号码规则的数字");return true}return false};service.validateAccountRemarkFail=function($scope){var $remark=$("#remark");var remark=$scope.account.remark;if(remark===undefined){remark=""}if(checkLengthFail(remark,100)){updateShowTipos($remark,"备注的格式为：0-100位任意字符");return true}return false};service.initTipsForAddTelecomAccountChange=function(){var $userName=$("#userName");var $roleId=$("#roleId");var $projectId=$("#projectId");var $provinceId=$("#provinceId");var $cityId=$("#cityId");var $areaId=$("#areaId");var $contactPerson=$("#contactPerson");var $contactWay=$("#contactWay");var $remark=$("#remark");initTipsArray([$userName,$roleId,$provinceId,$cityId,$areaId,$contactPerson,$contactWay,$remark]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$userName,$roleId,$provinceId,$cityId,$areaId,$contactPerson,$contactWay,$remark])})};service.validateAccountUserNameForAdminFail=function($scope){var $userName=$("#userName");var userName=$scope.account.userName;if(isBlank(userName)){updateShowTipos($userName,"账号不能为空！");return true}if(!chkString(userName,defrules.userName)){updateShowTipos($userName,"账号的格式为：1-50位字母、数字、下划线、连接符组成");return true}return false};service.validateAccountDeptNameForAdminFail=function($scope){var $deptName=$("#deptName");var deptName=$scope.account.deptName;if(isBlank(deptName)){deptName=""}if(deptName.length>50){updateShowTipos($deptName,"部门格式为：1-50位任意字符");return true}return false};service.validateAccountContactPersonForAdminFail=function($scope){var $contactPerson=$("#contactPerson");var contactPerson=$scope.account.contactPerson;if(isBlank(contactPerson)){updateShowTipos($contactPerson,"姓名不能为空！");return true}if(contactPerson.length>50){updateShowTipos($contactPerson,"姓名格式为：1-50位任意字符");return true}return false};service.validateAccountContactWayForAdminFail=function($scope){var $contactWay=$("#contactWay");var contactWay=$scope.account.contactWay;if(isBlank(contactWay)){updateShowTipos($contactWay,"联系电话不能为空！");return true}if(contactWay.length>50){updateShowTipos($contactWay,"联系电话格式为：1-50位任意字符");return true}return false};service.validateAccountRemarkForAdminFail=function($scope){var $remark=$("#remark");var remark=$scope.account.remark;if(isBlank(remark)){remark=""}if(remark.length>100){updateShowTipos($remark,"备注格式为：1-100位任意字符");return true}return false};service.initTipsForAddAdminCountChange=function(){var $userName=$("#userName");var $deptName=$("#deptName");var $contactPerson=$("#contactPerson");var $contactWay=$("#contactWay");var $remark=$("#remark");initTipsArray([$userName,$deptName,$contactPerson,$contactWay,$remark]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$userName,$deptName,$contactPerson,$contactWay,$remark])})};service.getCurUserInfo=function($scope){accountDao.getCurUserInfo($scope)};service.pwdEdit=function($scope){accountDao.pwdEdit($scope)};service.infoModify=function($scope){accountDao.infoModify($scope)};service.delete=function($scope,id){accountDao.delete($scope,id)};service.pwdReset=function($scope,id){accountDao.pwdReset($scope,id)};service.customerList=function($scope){accountDao.customerList($scope)};service.list=function($scope){accountDao.list($scope)};service.roleList=function($scope){accountDao.roleList($scope)};service.projectList=function($scope){accountDao.projectList($scope)};service.add=function($scope){accountDao.add($scope)};service.getAccountById=function($scope,id){accountDao.getAccountById($scope,id)};service.edit=function($scope){accountDao.edit($scope)};service.getPermissionById=function($scope){accountDao.getPermissionById($scope)};service.getPermission=function($scope){accountDao.getPermission($scope)};service.getExistPermission=function($scope){accountDao.getExistPermission($scope)};service.permissionAssign=function($scope){accountDao.permissionAssign($scope)};service.adminList=function($scope){accountDao.adminList($scope)};service.adminAdd=function($scope){accountDao.adminAdd($scope)};service.getAccountAdminById=function($scope,id){accountDao.getAccountAdminById($scope,id)};service.adminEdit=function($scope){accountDao.adminEdit($scope)};return service});indexApp.service("DateService",function(){var service={};var dt=new Date;var dt_year=dt.getFullYear();var dt_month=dt.getMonth()+1>0&&dt.getMonth()+1<10?"0"+(dt.getMonth()+1):dt.getMonth()+1;var dt_date=dt.getDate()>0&&dt.getDate()<10?"0"+dt.getDate():dt.getDate();service.monthEarly=function(){return dt_year+"-"+dt_month+"-"+"01"};service.getToday=function(){return dt_year+"-"+dt_month+"-"+dt_date};service.getYesterday=function(){var dt=new Date;dt.setDate(dt.getDate()-1);var dt_year=dt.getFullYear();var dt_month=dt.getMonth()+1>0&&dt.getMonth()+1<10?"0"+(dt.getMonth()+1):dt.getMonth()+1;var dt_date=dt.getDate()>0&&dt.getDate()<10?"0"+dt.getDate():dt.getDate();return dt_year+"-"+dt_month+"-"+dt_date};return service});indexApp.controller("defaultController",function($scope,defaultService){function userChartPie(user_new,user_old){var user_chart_pie=echarts.init(document.getElementById("user_chart_pie"));var user_chart_pie_option={tooltip:{trigger:"item",formatter:function(item){return item.seriesName+"<br />"+item.name+"："+(item.value?item.value:"0")+"("+(item.percent?item.percent:"0")+"%)"}},legend:{orient:"vertical",y:"bottom",data:["新用户","老用户"]},series:[{name:"新老用户占比",type:"pie",radius:["45%","60%"],data:[{value:user_new,name:"新用户",itemStyle:{normal:{color:"#D18381"}}},{value:user_old,name:"老用户",itemStyle:{normal:{color:"#B13432"}}}]}]};user_chart_pie.setOption(user_chart_pie_option)}function userChartLine(hour_data,today_data,yesterday_data){var user_chart_line=echarts.init(document.getElementById("user_chart_line"));var user_chart_line_option={tooltip:{trigger:"axis",formatter:function(item){var itemt=item[0],itemy=item[1];var xHour=itemy?itemy.name:itemt.name;var tips=(xHour?xHour:0)+"时<br />";if(itemt&&itemt.value&&xHour<(new Date).getHours()){tips+=itemt.seriesName+"："+(itemt.value?itemt.value:"0")+"<br />"}if(itemy&&itemy.value){tips+=itemy.seriesName+"："+(itemy.value?itemy.value:"0")}return tips}},legend:{orient:"horizontal",x:"right",data:[{name:"今日用户认证数",textStyle:{color:"#66CBFF"}},{name:"昨日用户认证数",textStyle:{color:"#66CC66"}}]},grid:{left:"3%",right:"1%",bottom:"3%",containLabel:true},xAxis:[{type:"category",boundaryGap:false,data:hour_data}],yAxis:[{type:"value"}],series:[{name:"今日用户认证数",type:"line",smooth:true,symbolSize:1,showSymbol:false,lineStyle:{normal:{color:"#66CBFF",width:1}},areaStyle:{normal:{color:"rgba(102, 203, 255, 0.70)"}},data:today_data},{name:"昨日用户认证数",type:"line",smooth:true,symbolSize:1,showSymbol:false,lineStyle:{normal:{color:"#66CC66",width:1}},areaStyle:{normal:{color:"rgba(102, 204, 102, 0.70)"}},data:yesterday_data}]};user_chart_line.setOption(user_chart_line_option)}function init(){defaultService.projectCountAPI($scope);defaultService.deviceCountAPI($scope);defaultService.userCountAPI($scope,userChartLine,userChartPie)}init()});indexApp.factory("defaultDao",function($http){var dao={};function commafy(num){num=num+"";var re=/(-?\d+)(\d{3})/;while(re.test(num)){num=num.replace(re,"$1,$2")}return num}dao.userCountAPI=function($scope,funLine,funPie){var url="/report/userTotal";$http.get(url).success(function(resp){if(resp.result==="OK"){$scope.user_today_count=commafy(resp.todayAthorUser);$scope.user_yesterday_count=commafy(resp.yesterdayAthorUser);$scope.user_uv_count=commafy(resp.totalUser);$scope.user_new=resp.newUser;$scope.user_old=resp.oldUser;funPie($scope.user_new,$scope.user_old);var hour_data=[],chart_today_data=[],chart_yesterday_data=[];var totalListTodayArray=resp.totalListToday;var totalListTodayLast=totalListTodayArray.pop();var totalListTodayLastX=totalListTodayLast["x"]||0;for(var i=0;i<totalListTodayLastX;i++){chart_today_data.push(0)}for(var i=0;i<=23;i++){hour_data.push(i);chart_yesterday_data.push(0)}var datas_today=resp.totalListToday;for(var i=0,len=datas_today.length;i<len;i++){var item=datas_today[i];chart_today_data[parseInt(item.x)]=item.y}var datas_yesterday=resp.totalListYsday;for(var i=0,len=datas_yesterday.length;i<len;i++){var item=datas_yesterday[i];chart_yesterday_data[parseInt(item.x)]=item.y}funLine(hour_data,chart_today_data,chart_yesterday_data)}})};dao.projectCountAPI=function($scope){var url="/project/count";$http.get(url).success(function(resp){if(resp.result==="OK"){$scope.project_count=commafy(resp.data)}})};dao.deviceCountAPI=function($scope){var url="/report/devTotal";$http.get(url).success(function(resp){if(resp.result==="OK"){$scope.device_counts=commafy(resp.device_num);$scope.device_online_count=commafy(resp.online_device_num);$scope.device_offline_count=commafy(parseInt(resp.device_num)-parseInt(resp.online_device_num))}})};return dao});indexApp.factory("defaultService",function(defaultDao){var service={};service.projectCountAPI=defaultDao.projectCountAPI;service.userCountAPI=defaultDao.userCountAPI;service.deviceCountAPI=defaultDao.deviceCountAPI;return service});indexApp.controller("customerBindingDeviceController",function($scope,$location,$timeout,$interval,Upload,customerService){$scope.download=function(){var fileName=$("#test_select1").val();if(isBlank(fileName)){var aId=$("#down");aId.removeAttr("href","");$("#validate_messsage").empty().html("设备类型不能为空！").show();return}};$scope.bindingDevice=function(file){var customerId=$scope.customerId;var customerName=$scope.customerName;var projectId=$scope.projectId;var fileName=file!==null&&file!==undefined?file.name:"";var deviceType=$("#test_select1").val();if(isBlank(deviceType)){$("#validate_messsage").empty().html("设备类型不能为空！").show();return}if(isBlank(fileName)){$("#validate_messsage").empty().html("请先上传Excel文件！").show();return}var fileSuffixArray=fileName.split(".");var fileSuffix=fileSuffixArray.length>1?$.trim(fileSuffixArray[1]):"";if(!(fileSuffix=="xls"||fileSuffix=="xlsx")){$("#validate_messsage").empty().html("文件格式错误，请上传Excel文件！").show();return}if(fileSuffix=="xlsx"){$("#validate_messsage").empty().html("文件格式错误，请上传xls格式文件！").show();return}$("#validate_messsage").empty().hide();file.upload=Upload.upload({url:"/device/bind?id="+customerId+"&projectId="+projectId+"&fileName="+deviceType,method:"POST",headers:{"my-header":"my-header-value"},file:file,fileFormDataName:"xlsFile"});file.upload.then(function(response){$timeout(function(){file.progress=100;file.result=response.data})},function(response){if(response.status>0){$scope.errorMsg=response.status+": "+response.data}});file.upload.progress(function(evt){var curProgress=Math.min(100,parseInt(100*evt.loaded/evt.total));if(curProgress>=90){curProgress=90}file.progress=curProgress});file.upload.xhr(function(xhr){})}});indexApp.controller("deviceAllocationController",function($scope,$location,deviceService,customerService){function list(){customerService.customerNameAndIndustryList($scope)}$scope.list=list;list();$scope.deviceAllocationBt=function($scope){var deviceIds=$location.search()["deviceIds"];var customerIds=$location.search()["customerIds"];deviceService.deviceAllocation($scope,deviceIds,customerIds)};function validateFail($scope){if(customerService.validateCustomerIdFail($scope)){return true}return false}});indexApp.controller("deviceEditController",function($scope,$location,locationService,deviceService){var id=$location.search()["id"];deviceService.findByDeviceId($scope,id);$scope.change=function($event){var industryId1=$scope.device.parentIndustryId;industryService.industry2List($scope,industryId1)};$scope.cityChange=function($event){var provinceId=$scope.device.provinceId;locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=$scope.device.cityId;locationService.countyList($scope,cityId)};function validateFail($scope){if(deviceService.validateProvinceFail($scope)){return true}if(deviceService.validateCityFail($scope)){return true}var optionSize=$("#countyId option").size();var optionValue=$("#countyId").val();if(optionSize>1&&optionValue==""){if(deviceService.validateCountyFail($scope)){return true}}if(deviceService.validateAddressFail($scope)){return true}if(deviceService.validateRemarkFail($scope)){return true}return false}$scope.deviceEdit=function(){if(validateFail($scope)){return}deviceService.deviceEdit($scope,id)};function init(){$scope.device={};locationService.provinceList($scope);deviceService.initTips()}init()});indexApp.controller("hotAreaImportController",function($scope,$timeout,$interval,Upload,staticUserService,customerService){$scope.uploadXls=function(file){var fileName=file!==null&&file!==undefined?file.name:"";if(isBlank(fileName)){$("#validate_messsage").empty().html("请先上传Excel文件！").show();return}var fileSuffixArray=fileName.split(".");var fileSuffix=fileSuffixArray.length>1?$.trim(fileSuffixArray[1]):"";if(!(fileSuffix=="xls"||fileSuffix=="xlsx")){$("#validate_messsage").empty().html("文件格式错误，请上传Excel文件！").show();return}$("#validate_messsage").empty().hide();file.upload=Upload.upload({url:"/hotArea/importHot",method:"POST",headers:{"my-header":"my-header-value"},file:file,fileFormDataName:"xlsFile"});file.upload.then(function(response){$timeout(function(){file.progress=100;file.result=response.data})},function(response){if(response.status>0){$scope.errorMsg=response.status+": "+response.data}});file.upload.progress(function(evt){var curProgress=Math.min(100,parseInt(100*evt.loaded/evt.total));if(curProgress>=90){curProgress=90}file.progress=curProgress});file.upload.xhr(function(xhr){})}});indexApp.controller("hotAreaListController",function($scope,$location,customerService,deviceService,locationService,hotAreaService,ngDialog){function list(){hotAreaService.hotAreaList($scope)}$scope.list=list;list();$scope.selectAll=function(){var checkboxAll=$(':checkbox[name="checkboxAll"]');var checkboxItems=$(':checkbox[name="checkboxItem"]');if(checkboxAll.prop("checked")){checkboxItems.prop("checked",true)}else{checkboxItems.prop("checked",false)}};function getCheckboxVaules(){var checkboxValues=[];var checkboxItems=$(':checkbox[name="checkboxItem"]');checkboxItems.each(function(){var that=$(this);var mac=$(this).val();if(mac==""){return}if(that.prop("checked")){checkboxValues.push($(this).val())}});return checkboxValues}$scope.cityChange=function($event){var provinceId=$scope.provinceId;locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=$scope.cityId;locationService.countyList($scope,cityId)};function init(){$scope.device={};locationService.provinceList($scope);customerService.customerSelect2("customerIdAndLevel");resetWidth()}init();$scope.deleteHotArea=function(){var ids=getCheckboxVaules();if(ids.length<=0){jDialog.alert("删除热点","您未选择要删除的热点数据！请选择");return}jDialog.confirm("删除热点",'<div class="rows"><label class="w100">您确定要删除所选的热点吗？</label></div>',function(){hotAreaService.delete($scope,ids.join(","));jDialog.hide()})};$scope.exportHotArea=function(){$('input[name="provinceId"]').val(defaultString($scope.provinceId));$('input[name="cityId"]').val(defaultString($scope.cityId));$('input[name="countyId"]').val(defaultString($scope.countyId));var customerIdAndLevelVal=$("#customerIdAndLevel").val();$("#customerId").val(customerIdAndLevelVal?customerIdAndLevelVal.split("#")[0]:"");$("#exportExcle").submit()};$scope.importHotArea=function(){ngDialog.open({template:"html/template/device/hotAreaImport.html",controller:"hotAreaImportController",scope:$scope,title:"热点下瘦AP导入",width:"45%"})}});indexApp.controller("deviceListController",function($scope,$location,deviceService,locationService,customerService,ngDialog){function init(){$scope.device={};locationService.provinceList($scope);customerService.customerSelect2("customerIdAndLevel")}init();function list(){deviceService.deviceList($scope)}$scope.list=list;list();$scope.cityChange=function($event){var provinceId=$scope.provinceId;locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=$scope.cityId;locationService.countyList($scope,cityId)};$scope.deviceAllocation=function($scope){var $box=$(".datacontent input[type='checkbox']:checked");var maxSize=$box.size();if(maxSize<=0){jDialog.alert("设备分配提示","您未选择要设备分配的数据！请选择");return}var customerIds="";var deviceIds="";$box.each(function(i){var customerId=$(this).parent().find("input[name='customerId']").val();customerIds=customerIds+customerId;if(i<maxSize-1){customerIds+=","}});$box.each(function(j){var deviceId=$(this).parent().find("input[name='deviceId']").val();deviceIds=deviceIds+deviceId;if(j<maxSize-1){deviceIds+=","}});var url="/device/deviceAllocation";var params={deviceIds:deviceIds,customerIds:customerIds};$location.path(url).search(params)};$scope.selectAll=function(){allCheckBoxs=document.getElementsByName("checkbox");var check=document.getElementsByName("allBox");if(check[0].checked){for(var i=0;i<allCheckBoxs.length;i++){if(!allCheckBoxs[i].disabled){allCheckBoxs[i].checked=true}}}else{for(var j=0;j<allCheckBoxs.length;j++){allCheckBoxs[j].checked=false}}};resetWidth();$scope.radio=function($event,customerId){var $subBox=$("input[name='checkbox']");var isAllChoosed=$("input[name='checkbox']:checked").length;var isAllChoosed1=$subBox.length==isAllChoosed;if(isAllChoosed1===true){var selectObj=document.getElementById("selectAll1");selectObj.checked=true}else{$("#selectAll1").attr("checked",false)}};$scope.show=function(id){$scope.id=id;ngDialog.open({template:"html/template/device/deviceShow.html",controller:"deviceShowController",scope:$scope,title:"设备详情",width:"45%"})}});indexApp.controller("deviceShowController",function($scope,$location,deviceService){var id=$scope.id||$location.search()["id"];deviceService.findByDeviceId($scope,id)});indexApp.factory("deviceDao",function($http,$location,pageDao,locationDao){var dao={};dao.deviceList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var provinceId=defaultString($scope.provinceId);var cityId=defaultString($scope.cityId);var countyId=defaultString($scope.countyId);var customerIdAndLevel=defaultString($scope.customerIdAndLevel);var customerIdAndLevelArray=customerIdAndLevel.split("#");var customerId=customerIdAndLevelArray[0];var cascadeLabel=customerIdAndLevelArray[1];if(isBlank(customerId)){customerId=""}if(isBlank(cascadeLabel)){cascadeLabel=""}var deviceName=defaultString($scope.deviceName);var apMac=defaultString($scope.apMac);var ssid=defaultString($scope.ssid);var devId=defaultString($scope.devId);if(pageNo=="上一页"||pageNo=="下一页"){return}var url="/device/list?pageNo="+pageNo+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&deviceName="+deviceName+"&customerId="+customerId+"&cascadeLabel="+cascadeLabel+"&apMac="+apMac+"&ssid="+ssid+"&devId="+devId;$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.devices=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.findByDeviceId=function($scope,id){var url="/device/show?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.device=data.data;$scope.device.address=$scope.device.fixAddr;if($scope.device.provinceId!==undefined){locationDao.cityList($scope,$scope.device.provinceId)}if($scope.device.cityId!==undefined){locationDao.countyList($scope,$scope.device.cityId)}})};dao.deviceAllocation=function($scope,deviceIds,customerIds){$("#deviceId").attr("disabled",true);var toCustomerId=$("input[name='radio']:checked").parent().find("input[name='customerId']").val();if(isBlank(toCustomerId)){jDialog.alert("设备分配","请选择要分配设备的客户！");return}var url="/device/transfer?ids="+deviceIds+"&customerIds="+customerIds+"&toCustomerId="+toCustomerId;$http.post(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);$("#deviceId").removeAttr("disabled");return}jDialog.alert("设备分配","分配成功！");$location.path("device/list")})};dao.deviceEdit=function($scope,deviceId){$("#btnSubmit").attr("disabled",true);var provinceId=$scope.device.provinceId;var cityId=$scope.device.cityId;var countyId=defaultString($scope.device.countyId);var address=defaultString($scope.device.address);var remark=defaultString($scope.device.remarks);var params={deviceId:deviceId,provinceId:provinceId,cityId:cityId,countyId:countyId,address:address,remark:remark};var url="/device/edit?"+$.param(params);$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);$("#btnSubmit").removeAttr("disabled");return}jDialog.alert("编辑设备","编辑设备信息成功！");$location.path("device/list")})};return dao});indexApp.factory("hotAreaDao",function($http,$location,pageDao,locationDao){var dao={};dao.hotAreaList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var provinceId=defaultString($scope.provinceId);var cityId=defaultString($scope.cityId);var countyId=defaultString($scope.countyId);var customerIdAndLevel=defaultString($scope.customerIdAndLevel);var customerIdAndLevelArray=customerIdAndLevel.split("#");var customerId=customerIdAndLevelArray[0];var cascadeLabel=customerIdAndLevelArray[1];if(isBlank(customerId)){customerId=""}if(isBlank(cascadeLabel)){cascadeLabel=""}var keywords=defaultString($scope.keywords);var mac=defaultString($scope.mac);var deviceState=defaultString($scope.deviceState);if(pageNo=="上一页"||pageNo=="下一页"){return}var params={pageNo:pageNo,customerId:customerId,cascadeLabel:cascadeLabel,deviceState:deviceState,keywords:keywords,mac:mac,provinceId:provinceId,cityId:cityId,countyId:countyId};var url="/hotArea/list?"+$.param(params);$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.hotAreas=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.delete=function($scope,ids){var url="/hotArea/delete?mac="+ids;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.alert("热点删除：",data.message||"删除成功");$scope.list();
})};return dao});indexApp.factory("deviceService",function($rootScope,deviceDao){var service={};service.deviceList=function($scope){deviceDao.deviceList($scope)};service.findByDeviceId=function($scope,id){deviceDao.findByDeviceId($scope,id)};service.deviceAllocation=function($scope,deviceIds,customerIds){deviceDao.deviceAllocation($scope,deviceIds,customerIds)};service.validateProvinceFail=function($scope){var $province=$("#provinceId");var province=$scope.device.provinceId;if(isBlank(province)){updateShowTipos($province,"区域省不能为空！");return true}return false};service.validateCityFail=function($scope){var $city=$("#cityId");var city=$scope.device.cityId;if(isBlank(city)){updateShowTipos($city,"区域市不能为空！");return true}return false};service.validateCountyFail=function($scope){var $county=$("#countyId");var county=$scope.device.countyId;if(isBlank(county)){updateShowTipos($county,"区域区/县不能为空！");return true}return false};service.validateAddressFail=function($scope){var $address=$("#address");var address=$scope.device.address;if(isNotBlank(address)&&address.length>60){updateShowTipos($address,"详细地址长度不能超过60个字符！");return true}return false};service.validateRemarkFail=function($scope){var $remark=$("#remark");var remark=$scope.device.remark;if(isNotBlank(remark)&&remark.length>500){updateShowTipos($remark,"备注长度不能超过500个字符！");return true}return false};service.initTipsDeviceMonitor=function(){var $deviceMac=$("#deviceMac");initTipsArray([$deviceMac]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$deviceMac])})};service.validateDeviceMacFail=function($scope){var $deviceMac=$("#deviceMac");var deviceMac=$scope.apMac;if(!isBlank(deviceMac)&&!/^[a-fA-F0-9]{12}$/.test(deviceMac)){updateShowTipos($deviceMac,"设备MAC由数字0-9，字母A-F或a-f组合的12位字符");return true}return false};service.deviceSsidSelect2=function(selectId,customerId,ajaxUrl){var _ajaxUrl=ajaxUrl||"/devicemonitor/ssidList";var _selectId=selectId||"deviceSsid";return deviceSsidSelect(_selectId,customerId,_ajaxUrl)};function deviceSsidSelect(selectId,customerId,ajaxUrl){var select2=$("#"+selectId).select2({placeholder:"请选择SSID",allowClear:true,ajax:{url:ajaxUrl,dataType:"json",delay:0,data:function(params){return{customerId:customerId,keywords:params.term}},processResults:function(data,params){var _data=data.data;var ret_data=[];for(var i=0,len=_data.length;i<len;i++){var val=_data[i];ret_data.push({id:val,text:val})}return{results:ret_data}},cache:true},escapeMarkup:function(markup){return markup},templateResult:function(data){if(data.loading)return"正在搜索...";var markup="<div>"+data.text+"</div>";return markup},templateSelection:function(data){return data.text}}).val("").trigger("change");return select2}service.deviceMonitorList=function($scope){deviceDao.deviceMonitorList($scope)};service.deviceEdit=function($scope,id){deviceDao.deviceEdit($scope,id)};service.initTips=function(){var $provinceId=$("#provinceId");var $cityId=$("#cityId");var $countyId=$("#countyId");var $address=$("#address");var $remark=$("#remark");initTipsArray([$provinceId,$cityId,$countyId,$address,$remark]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$provinceId,$cityId,$countyId,$address,$remark])})};return service});indexApp.factory("hotAreaService",function($rootScope,hotAreaDao){var service={};service.hotAreaList=function($scope){hotAreaDao.hotAreaList($scope)};service.delete=function($scope,ids){hotAreaDao.delete($scope,ids)};return service});indexApp.directive("permissionmenu",function($cacheFactory){return{restrict:"EA",replace:false,link:function(scope,element,attrs){var code=attrs.permissionmenu;if(isBlank(code)){return}var permissionCache=$cacheFactory.get("permissionCache");var codeData=permissionCache.get("codes");var portalMenuArray=["site_manager","site_manager_list","site_manager_default","strategy_manager","strategy_manager_list"];var userType=codeData.userType;if(userType!=1){var portalMenuArrayLength=portalMenuArray.length;for(var i=0;i<portalMenuArrayLength;i++){if(code==portalMenuArray[i]){return}}}var codeArray=codeData.codes;var maxLength=codeArray!=null?codeArray.length:0;var hasPermission=false;for(var i=0;i<maxLength;i++){if(code==codeArray[i]){hasPermission=true;break}}if(hasPermission){element.show();element.addClass("show")}}}});indexApp.directive("permission",function($cacheFactory){return{restrict:"EA",replace:false,link:function(scope,element,attrs){var code=attrs.permission;if(isBlank(code)){return}var permissionCache=$cacheFactory.get("permissionCache");var codeData=permissionCache.get("codes");var codeArray=codeData.codes;var maxLength=codeArray!==null?codeArray.length:0;var hasPermission=false;for(var i=0;i<maxLength;i++){if(code==codeArray[i]){hasPermission=true;break}}if(!hasPermission){element.remove()}}}});indexApp.config(function($routeProvider,$httpProvider){$routeProvider.when("/",{templateUrl:"html/template/default.html",controller:"defaultController"}).when("/customer/list",{templateUrl:"html/template/customer/customerList.html",controller:"customerListController"}).when("/customer/add",{templateUrl:"html/template/customer/customerAdd.html",controller:"customerAddController"}).when("/customer/show",{templateUrl:"html/template/customer/customerShow.html",controller:"customerShowController"}).when("/customer/edit",{templateUrl:"html/template/customer/customerEdit.html",controller:"customerEditController"}).when("/project/customerDetails",{templateUrl:"html/template/project/projectCustomerDetails.html",controller:"projectCustomerDetailsController"}).when("/customer/addSubordinateUnit",{templateUrl:"html/template/customer/addSubordinateUnit.html",controller:"customeraddSubordinateUnitController"}).when("/account/pwdEdit",{templateUrl:"html/template/account/pwdEdit.html",controller:"pwdEditController"}).when("/account/infoModify",{templateUrl:"html/template/account/accountInfoModify.html",controller:"accountInfoModifyController"}).when("/platform/list",{templateUrl:"html/template/platform/platformList.html",controller:"platformListController"}).when("/platform/add",{templateUrl:"html/template/platform/platformAdd.html",controller:"platformAddController"}).when("/platform/edit",{templateUrl:"html/template/platform/platformEdit.html",controller:"platformEditController"}).when("/project/list",{templateUrl:"html/template/project/projectList.html",controller:"projectListController"}).when("/project/add",{templateUrl:"html/template/project/projectAdd.html",controller:"projectAddController"}).when("/project/edit",{templateUrl:"html/template/project/projectEdit.html",controller:"projectEditController"}).when("/project/projectCustomerList",{templateUrl:"html/template/project/projectCustomerList.html",controller:"projectCustomerListController"}).when("/project/projectCustomerNextLevelList",{templateUrl:"html/template/project/projectCustomerNextLevelList.html",controller:"projectCustomerNextLevelListController"}).when("/account/telecomList",{templateUrl:"html/template/account/accountTelecomList.html",controller:"accountTelecomListController"}).when("/account/customerList",{templateUrl:"html/template/account/accountCustomerList.html",controller:"accountCustomerListController"}).when("/account/permissionAssignTelecom",{templateUrl:"html/template/account/permissionAssignTelecom.html",controller:"permissionAssignTelecomController"}).when("/account/permissionAssignCustomer",{templateUrl:"html/template/account/permissionAssignCustomer.html",controller:"permissionAssignCustomerController"}).when("/account/add",{templateUrl:"html/template/account/accountAdd.html",controller:"accountAddController"}).when("/account/edit",{templateUrl:"html/template/account/accountEdit.html",controller:"accountEditController"}).when("/account/adminList",{templateUrl:"html/template/account/accountAdminList.html",controller:"accountAdminListController"}).when("/account/adminAdd",{templateUrl:"html/template/account/accountAdminAdd.html",controller:"accountAdminAddController"}).when("/account/adminEdit",{templateUrl:"html/template/account/accountAdminEdit.html",controller:"accountAdminEditController"}).when("/staticuser/blackUserList",{templateUrl:"html/template/staticuser/blackUserList.html",controller:"blackUserController"}).when("/staticuser/blackUserAdd",{templateUrl:"html/template/staticuser/blackUserAdd.html",controller:"blackUserAddController"}).when("/staticuser/whiteUserList",{templateUrl:"html/template/staticuser/whiteUserList.html",controller:"whiteUserListController"}).when("/staticuser/whiteUserAdd",{templateUrl:"html/template/staticuser/whiteUserAdd.html",controller:"whiteUserAddController"}).when("/staticUser/staticUserList",{templateUrl:"html/template/staticuser/staticUserList.html",controller:"staticUserListController"}).when("/staticUser/staticUserAdd",{templateUrl:"html/template/staticuser/staticUserAdd.html",controller:"staticUserAddController"}).when("/staticUser/staticUserEdit",{templateUrl:"html/template/staticuser/staticUserEdit.html",controller:"staticUserEditController"}).when("/portal/site/siteList",{templateUrl:"html/template/portal/site/siteList.html",controller:"siteListController"}).when("/portal/site/defaultSiteList",{templateUrl:"html/template/portal/site/defaultSiteList.html",controller:"defaultSiteListController"}).when("/portal/template/templateList",{templateUrl:"html/template/portal/template/templateList.html",controller:"templateListController"}).when("/portal/component/componentList",{templateUrl:"html/template/portal/component/componentList.html",controller:"componentListController"}).when("/portal/component/componentAdd",{templateUrl:"html/template/portal/component/componentAdd.html",controller:"componentAddController"}).when("/portal/strategy/strategyList",{templateUrl:"html/template/portal/strategy/strategyList.html",controller:"strategyListController"}).when("/portal/strategy/strategyAdd",{templateUrl:"html/template/portal/strategy/strategyAdd.html",controller:"strategyAddController"}).when("/portal/strategy/strategyEdit",{templateUrl:"html/template/portal/strategy/strategyEdit.html",controller:"strategyEditController"}).when("/report/portalReportList",{templateUrl:"html/template/report/portalReportList.html",controller:"portalReportListController"}).when("/report/portalPVChart",{templateUrl:"html/template/report/portalPVChart.html",controller:"portalPVChartController"}).when("/report/portalUVChart",{templateUrl:"html/template/report/portalUVChart.html",controller:"portalUVChartController"}).when("/report/deviceReportList",{templateUrl:"html/template/report/deviceReportList.html",controller:"deviceReportListController"}).when("/report/deviceKeyIndex",{templateUrl:"html/template/report/deviceKeyIndex.html",controller:"deviceKeyIndexController"}).when("/report/deviceChart",{templateUrl:"html/template/report/deviceChart.html",controller:"deviceChartController"}).when("/report/deviceProjectReportList",{templateUrl:"html/template/report/deviceProjectReportList.html",controller:"deviceProjectReportListController"}).when("/sysconfig/list",{templateUrl:"html/template/system/sysConfigList.html",controller:"sysConfigController"}).when("/sysconfig/add",{templateUrl:"html/template/system/sysConfigAdd.html",controller:"sysConfigAddController"}).when("/sysconfig/edit",{templateUrl:"html/template/system/sysConfigEdit.html",controller:"sysConfigEditController"}).when("/exceptionlog/list",{templateUrl:"html/template/log/exceptionlogList.html",controller:"exceptionlogListController"}).when("/operationlog/list",{templateUrl:"html/template/log/operationlogList.html",controller:"operationlogListController"}).when("/theme/list",{templateUrl:"html/template/system/theme/themeList.html",controller:"themeListController"}).when("/theme/add",{templateUrl:"html/template/system/theme/themeAdd.html",controller:"themeAddController"}).when("/theme/edit",{templateUrl:"html/template/system/theme/themeEdit.html",controller:"themeEditController"}).when("/themeStrategy/list",{templateUrl:"html/template/system/theme/themeStrategyList.html",controller:"themeStrategyListController"}).when("/themeStrategy/add",{templateUrl:"html/template/system/theme/themeStrategyAdd.html",controller:"themeStrategyAddController"}).when("/themeStrategy/edit",{templateUrl:"html/template/system/theme/themeStrategyEdit.html",controller:"themeStrategyEditController"}).when("/requestLog/list",{templateUrl:"html/template/log/requestLogList.html",controller:"requestLogListController"}).when("/requestLog/show",{templateUrl:"html/template/log/requestLogShow.html",controller:"requestLogShowController"}).when("/device/list",{templateUrl:"html/template/device/deviceList.html",controller:"deviceListController"}).when("/device/show",{templateUrl:"html/template/device/deviceShow.html",controller:"deviceShowController"}).when("/device/deviceAllocation",{templateUrl:"html/template/device/deviceAllocation.html",controller:"deviceAllocationController"}).when("/device/edit",{templateUrl:"html/template/device/deviceEdit.html",controller:"deviceEditController"}).when("/hotarea/list",{templateUrl:"html/template/device/hotAreaList.html",controller:"hotAreaListController"}).when("/noperception/list",{templateUrl:"html/template/system/noperceptionList.html",controller:"noperceptionListController"}).when("/noperception/add",{templateUrl:"html/template/system/noperceptionAdd.html",controller:"noperceptionAddController"}).when("/noperception/edit",{templateUrl:"html/template/system/noperceptionEdit.html",controller:"noperceptionEditController"}).when("/noperception/show",{templateUrl:"html/template/system/noperceptionShow.html",controller:"noperceptionShowController"}).otherwise({redirectTo:"/"})});indexApp.controller("projectAddController",function($scope,locationService,projectService){function validateFail($scope){if(projectService.validateProjectNameFail($scope)){return true}if(projectService.validateContactNameFail($scope)){return true}if(projectService.validateContactWayFail($scope)){return true}if(projectService.validateProvinceIdFail($scope)){return true}return false}$scope.add=function(){if(validateFail($scope)){return}projectService.add($scope)};$scope.cityChange=function($event){var provinceId=defaultString($scope.project.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.project.cityId);locationService.countyList($scope,cityId)};function init(){$scope.project={};projectService.getAllPlatformInfo($scope);projectService.initTipsForAddProjectChange();locationService.provinceList($scope)}init()});indexApp.controller("projectCustomerDetailsController",function($scope,$location,customerService,projectService,pageDao){var customerId=$scope.customerId;$scope.projectCustomerDetailsHasData={customer:false,device:false,strategy:false};function showCustomerList(customerId,tabDivName){$scope.tabDivName=tabDivName;if(tabDivName==="device"){if(!$scope.projectCustomerDetailsHasData["device"]){projectService.customerDeviceList($scope);$scope.projectCustomerDetailsHasData["device"]=true}}else if(tabDivName==="strategy"){if(!$scope.projectCustomerDetailsHasData["strategy"]){projectService.customerStrategyList($scope);projectService.customerSiteList($scope);$scope.projectCustomerDetailsHasData["strategy"]=true}}else{if(!$scope.projectCustomerDetailsHasData["customer"]){customerService.findByCustomerId($scope,customerId);$scope.projectCustomerDetailsHasData["customer"]=true}}}$scope.showCustomerList=showCustomerList;showCustomerList(customerId,"customer");$scope.dialogDeviceList=function(){projectService.customerDeviceList($scope)}});indexApp.controller("projectCustomerListController",function($scope,$location,projectService,customerService){var projectId=$location.search()["projectId"];$scope.projectId=projectId;function list(){projectService.projectCustomerList($scope)}$scope.list=list;list();function init(){var projectName=$location.search()["projectName"];$scope.projectName=projectName}init();function newWidth(){var width=document.body.clientWidth;$("#reset").css("width",width-225)}newWidth();resetWidth();$scope.customerDetails=function(customerId){customerService.customerDetails($scope,customerId)}});indexApp.controller("projectCustomerNextLevelListController",function($scope,$location,projectService,customerService){var projectId=$location.search()["projectId"];$scope.projectId=projectId;var customerId=$location.search()["customerId"];$scope.customerId=customerId;var cascadeLevel=$location.search()["cascadeLevel"];$scope.cascadeLevel=cascadeLevel;function list(){projectService.projectCustomerNextList($scope)}$scope.list=list;list();function init(){var projectName=$location.search()["projectName"];$scope.projectName=projectName;var linkCustomerName=$location.search()["customerName"];$scope.linkCustomerName=linkCustomerName;var customerId=$location.search()["customerId"];$scope.customerId=customerId}init();function newWidth(){var width=document.body.clientWidth;$("#reset").css("width",width-225)}newWidth();resetWidth();$scope.customerDetails=function(customerId){customerService.customerDetails($scope,customerId)}});indexApp.controller("projectEditController",function($scope,$location,locationService,projectService){function validateFail($scope){if(projectService.validateProjectNameFail($scope)){return true}if(projectService.validateContactNameFail($scope)){return true}if(projectService.validateContactWayFail($scope)){return true}if(projectService.validatePlatformFail($scope)){return true}if(projectService.validateProvinceIdFail($scope)){return true}return false}$scope.edit=function(){if(validateFail($scope)){return}projectService.edit($scope)};$scope.cityChange=function($event){var provinceId=defaultString($scope.project.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.project.cityId);locationService.countyList($scope,cityId)};function init(){var id=$location.search()["id"];$scope.id=id;projectService.getAllPlatformInfo($scope);projectService.getProjectInfoById($scope,id);projectService.initTipsForAddProjectChange();locationService.provinceList($scope)}init()});indexApp.controller("projectListController",function($scope,locationService,projectService){function list(){projectService.projectList($scope)}$scope.list=list;list();$scope.delete=function(projectId){jDialog.confirm("删除项目",'<div class="rows"><label class="w100">您确定要删除该项目吗？</label></div>',function(){projectService.delete($scope,projectId);jDialog.hide()})};function exportProjects(){projectService.exportProjects($scope)}$scope.exportProjects=exportProjects;$scope.cityChange=function($event){var provinceId=defaultString($scope.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.cityId);locationService.countyList($scope,cityId)};function init(){resetWidth();projectService.projectSelect2("fkProjectId");projectService.getAllPlatformInfo($scope);locationService.provinceList($scope)}init()});indexApp.factory("projectDao",function($http,$location,locationDao,pageDao){var dao={};dao.projectNameList=function($scope){var keywords=defaultString($scope.customer.projectId);var url="/project/projectList?keywords="+keywords;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert(data.message);return}projectNames=data.data;$scope.projectNames=data.data})};dao.projectList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var platformId=$scope.platformId;if(isBlank(platformId)){platformId=""}if(pageNo=="上一页"||pageNo=="下一页"){return}var provinceId=$scope.provinceId;var cityId=$scope.cityId;var areaId=$scope.areaId;if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(areaId)){areaId=""}var url="project/list?pageNo="+pageNo+"&platformId="+platformId+"&keywords="+keywords+"&provinceId="+provinceId+"&cityId="+cityId+"&areaId="+areaId;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}projects=data.records;$scope.projects=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.delete=function($scope,projectId){var url="project/delete?id="+projectId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.alert("项目删除：",data.message||"删除成功");$scope.list()})};dao.getAllPlatformInfo=function($scope){var url="platform/platforminfo";$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}platforms=data.data;$scope.platforms=data.data})};dao.add=function($scope){$("#projectAdd").attr("disabled",true);var projectName=defaultString($scope.project.projectName);var contact=defaultString($scope.project.contact);var contactWay=defaultString($scope.project.contactWay);var platform=$scope.project.platformId;var remark=defaultString($scope.project.remark);var provinceId=$scope.project.provinceId;var cityId=$scope.project.cityId;var areaId=$scope.project.areaId;projectName=encodeURIComponent(projectName);contact=encodeURIComponent(contact);remark=encodeURIComponent(remark);if(isBlank(platform)){platform=""}if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(areaId)){areaId=""}if(isBlank(remark)){remark=""}var url="project/add?projectName="+projectName+"&contact="+contact+"&contactWay="+contactWay+"&platform="+platform+"&provinceId="+provinceId+"&cityId="+cityId+"&areaId="+areaId+"&remark="+remark;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);$("#projectAdd").removeAttr("disabled");return}jDialog.alert("添加新项目:","添加成功！");$scope.list()})};dao.getProjectInfoById=function($scope,id){var url="project/projectShow?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.project=data.data;if($scope.project.provinceId===undefined){$scope.project.provinceId=""}else{$scope.project.provinceId=$scope.project.provinceId+"";if($scope.project.cityId===undefined){$scope.project.cityId=""}else{$scope.project.cityId=$scope.project.cityId+"";locationDao.cityList($scope,$scope.project.provinceId);if($scope.project.countyId===undefined){$scope.project.countyId=""}else{$scope.project.countyId=$scope.project.countyId+"";locationDao.countyList($scope,$scope.project.cityId)}}}})};dao.edit=function($scope){$("#projectEdit").attr("disabled",true);var id=$scope.id;var projectName=defaultString($scope.project.projectName);var contact=defaultString($scope.project.contact);var contactWay=defaultString($scope.project.contactWay);var platform=$scope.project.platformId;var remark=defaultString($scope.project.remark);var provinceId=$scope.project.provinceId;var cityId=$scope.project.cityId;var areaId=$scope.project.countyId;projectName=encodeURIComponent(projectName);contact=encodeURIComponent(contact);remark=encodeURIComponent(remark);if(isBlank(platform)){platform=""}if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(areaId)){areaId=""}if(isBlank(remark)){remark=""}var url="project/edit?id="+id+"&projectName="+projectName+"&contact="+contact+"&contactWay="+contactWay+"&platform="+platform+"&provinceId="+provinceId+"&cityId="+cityId+"&areaId="+areaId+"&remark="+remark;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);$("#projectEdit").removeAttr("disabled");return}jDialog.alert("编辑项目信息:","修改成功！");$location.path("project/list")})};dao.getProject=function($scope){var url="project/show";$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}project=data.data;$scope.project=data.data})};dao.projectCustomerList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var customerId="";var projectId=$scope.projectId;var cascadeLevel="";var customerName=defaultString($scope.customerName);customerName=encodeURIComponent(customerName);var url="/project/customerList?pageNo="+pageNo+"&customerId="+customerId+"&projectId="+projectId+"&cascadeLevel="+cascadeLevel+"&customerName="+customerName;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}projectCustomers=data.records;$scope.projectCustomers=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.projectCustomerNextList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var customerId=$scope.customerId;var projectId=$scope.projectId;var cascadeLevel=$scope.cascadeLevel;var customerName=defaultString($scope.customerName);customerName=encodeURIComponent(customerName);var url="/project/customerList?pageNo="+pageNo+"&customerId="+customerId+"&projectId="+projectId+"&cascadeLevel="+cascadeLevel+"&customerName="+customerName;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}projectNextCustomers=data.records;$scope.projectNextCustomers=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.customerDeviceList=function($scope){loadingAppend();var pageNo=$scope.pageNo2;if(isNaN(pageNo)){pageNo=1}var customerId=defaultString($scope.customerId);var url="/device/deviceList?pageNo="+pageNo+"&customerId="+customerId;$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.devices=data.records;$scope.begin=data.begin;$scope.data=data;$scope.pageNo2=pageNo;pageDao.dialogPageInit($scope,data,$scope.dialogDeviceList)})};dao.customerSiteList=function($scope){loadingAppend();var customerId=defaultString($scope.customerId);var url="/site/siteList?pageNo=1&customerId="+customerId;$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.sites=data.records})};dao.customerStrategyList=function($scope){var customerId=defaultString($scope.customerId);var url="/strategy/customer/list?pageNo=1&customerId="+customerId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.strategys=data.data})};dao.exportProjects=function($scope){$("#exportExcle").submit()};return dao});indexApp.factory("projectService",function($rootScope,$location,projectDao){var service={};service.validateProjectNameFail=function($scope){var $projectName=$("#projectName");var projectName=$scope.project.projectName;if(isBlank(projectName)){updateShowTipos($projectName,"项目名称不能为空！");return true}if(!chkString(projectName,defrules.wifiProjectName)){updateShowTipos($projectName,"项目名称格式为：1-50位汉字，字母，下划线、数字，不含特殊字符！");return true}return false};service.validateContactNameFail=function($scope){var $contact=$("#contact");var contact=$scope.project.contact;if(!chkString(contact,defrules.contactNew)){updateShowTipos($contact,"联系人必须由20位以内字符组成，包括汉字、字母，不含特殊字符！");return true}return false};service.validateContactWayFail=function($scope){var $contactWay=$("#contactWay");var contactWay=$scope.project.contactWay;if(!chkString(contactWay,defrules.contactWay)){updateShowTipos($contactWay,"联系方式格式为：11位以1开头符合手机号码规则的数字！");return true}return false};service.validatePlatformFail=function($scope){var $platform=$("#platform");var platform=$scope.project.platformId;if(isBlank(platform)){updateShowTipos($platform,"请选择一个平台！");return true}return false};service.validateProvinceIdFail=function($scope){var $provinceId=$("#provinceId");var provinceId=$scope.project.provinceId;if(isBlank(provinceId)){updateShowTipos($provinceId,"请选择一个省！");return true}return false};service.initTipsForAddProjectChange=function(){var $projectName=$("#projectName");var $contact=$("#contact");var $contactWay=$("#contactWay");var $platform=$("#platform");var $provinceId=$("#provinceId");initTipsArray([$projectName,$contact,$contactWay,$platform,$provinceId]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$projectName,$contact,$contactWay,$platform,$provinceId])})};service.projectNameList=function($scope){projectDao.projectNameList($scope)};service.projectList=function($scope){projectDao.projectList($scope)};service.delete=function($scope,projectId){projectDao.delete($scope,projectId)};service.getAllPlatformInfo=function($scope){projectDao.getAllPlatformInfo($scope)};service.add=function($scope){projectDao.add($scope)};service.getProjectInfoById=function($scope,id){projectDao.getProjectInfoById($scope,id)};service.edit=function($scope){projectDao.edit($scope)};service.getProject=function($scope){projectDao.getProject($scope)};service.projectCustomerList=function($scope){projectDao.projectCustomerList($scope)};service.projectCustomerNextList=function($scope){projectDao.projectCustomerNextList($scope)};service.exportProjects=function($scope){projectDao.exportProjects($scope)};service.customerDeviceList=function($scope){projectDao.customerDeviceList($scope)};service.customerStrategyList=function($scope){projectDao.customerStrategyList($scope)};service.customerSiteList=function($scope){projectDao.customerSiteList($scope)};service.projectSelect2=function(selectId){selectId=selectId||"fkProjectId";var ajaxUrl="/project/projectList";return projectSelect(selectId,ajaxUrl)};function projectSelect(selectId,ajaxUrl){var userId=$location.search()["userId"];req_data={userId:userId};var $select=$("#"+selectId);var project_select=$select.select2({language:"zh-CN",placeholder:"请选择项目",allowClear:true,ajax:{url:ajaxUrl,dataType:"json",delay:0,data:function(params){return{keywords:params.term,userId:req_data.userId?req_data.userId:""}},processResults:function(data,params){var _data=data.data;for(var i=0,len=_data.length;i<len;i++){var _item=_data[i];_item["id"]=_item.projectId;_item["text"]=_item.projectName}return{results:_data}},cache:true},escapeMarkup:function(markup){return markup},templateResult:function(data){if(data.loading)return"正在搜索...";var markup="<div>"+data.projectName+"</div>";return markup},templateSelection:function(data){return data.projectName||data.text}});return project_select}return service});indexApp.controller("exceptionlogListController",function($scope,exceptionlogService,ngDialog){var curDate=getCurDateHour();var defaultStartDate=curDate+":00";var defaultEndDate=curDate+":55";$scope.startDate=defaultStartDate;$scope.endDate=defaultEndDate;function list(){exceptionlogService.list($scope)}$scope.list=list;function initConditionForDate(){var $startDate=$("input[data-ng-model='startDate']");var $endDate=$("input[data-ng-model='endDate']");$startDate.datetimepicker({format:"Y-m-d H:i",value:defaultStartDate,step:5,onShow:function(){var endDate=$endDate.val();this.setOptions({maxDate:endDate?endDate:false})},a:""});$endDate.datetimepicker({format:"Y-m-d H:i",value:defaultEndDate,step:5,onShow:function(){var startDate=$startDate.val();this.setOptions({minDate:startDate?startDate:false})},a:""})}$scope.show=function(id){$scope.id=id;ngDialog.open({template:"html/template/log/exceptionlogShow.html",controller:"exceptionlogShowController",title:"异常日志详情",width:"45%",scope:$scope})};function init(){resetWidth();initConditionForDate();list()}init()});indexApp.controller("exceptionlogShowController",function($scope,exceptionlogService){var id=$scope.id;exceptionlogService.show($scope,id)});indexApp.controller("operationlogListController",function($scope,operationlogService,DateService,ngDialog){function init(){$scope.startDate=DateService.getToday()}init();function list(){operationlogService.list($scope)}$scope.list=list;function initConditionForDate(){var $startDate=$("#startDate");$startDate.datepicker({maxDate:"+0D",onSelect:function(dateText,inst){$scope.startDate=dateText}})}$scope.show=function(id){$scope.id=id;ngDialog.open({template:"html/template/log/operationlogShow.html",
controller:"operationlogShowController",title:"操作日志详情",width:"45%",scope:$scope})};function main(){resetWidth();initConditionForDate();list()}main()});indexApp.controller("operationlogShowController",function($scope,operationlogService){var id=$scope.id;operationlogService.show($scope,id)});indexApp.controller("requestLogListController",function($scope,requestLogService,DateService,ngDialog){function init(){$scope.startDate=DateService.monthEarly();$scope.endDate=DateService.getToday();$("#startDate").datepicker();$("#endDate").datepicker();requestLogService.initTipsForListDateChange()}init();function initConditionForDate(){var $startDate=$("#startDate");var $endDate=$("#endDate");$startDate.datepicker({onSelect:function(dateText,inst){$endDate.datepicker("option","minDate",new Date(dateText.replace("-",",")));$scope.startDate=dateText}});$endDate.datepicker({onSelect:function(dateText,inst){$startDate.datepicker("option","maxDate",new Date(dateText.replace("-",",")));$scope.endDate=dateText}})}function validateListDateFail($scope){if(requestLogService.validateListStartDateFail($scope)){return true}if(requestLogService.validateListEndDateFail($scope)){return true}return false}function list(){if(validateListDateFail($scope)){return}requestLogService.list($scope);initConditionForDate()}$scope.list=list;$scope.show=function(id){$scope.id=id;ngDialog.open({template:"html/template/log/requestLogShow.html",controller:"requestLogShowController",scope:$scope,title:"请求日志详情",width:"45%"})};function main(){list();resetWidth()}main()});indexApp.controller("requestLogShowController",function($scope,requestLogService){var id=$scope.id;requestLogService.show($scope,id)});indexApp.controller("sysConfigAddController",function($scope,sysConfigService){$scope.add=function(){if(sysConfigService.paramValidateFail($scope))return;sysConfigService.add($scope)};function init(){$scope.sysconfig={};sysConfigService.initTips()}init()});indexApp.controller("sysConfigController",function(sysConfigService,$scope,$location,customerService,ngDialog){function list(){sysConfigService.list($scope)}$scope.list=list;list();$scope.show=function(id){$scope.id=id;ngDialog.open({template:"html/template/system/sysConfigShow.html",controller:"sysConfigShowController",title:"系统参数配置详细信息",width:"45%",scope:$scope})};$scope.delete=function(id){jDialog.confirm("删除参数配置",'<div class="rows"><label class="w100">您确定要删除该参数吗？</label></div>',function(){sysConfigService.remove($scope,id);jDialog.hide()})};resetWidth()});indexApp.controller("sysConfigEditController",function($scope,$location,sysConfigService){$scope.edit=function edit(){if(sysConfigService.paramValidateFail($scope))return;sysConfigService.edit($scope)};function init(){var sysconfigId=$location.search()["sysconfigId"];sysConfigService.show($scope,sysconfigId);sysConfigService.initTips()}init()});indexApp.controller("sysConfigShowController",function($scope,sysConfigService){var id=$scope.id;sysConfigService.show($scope,id)});indexApp.factory("exceptionlogDao",function($http,pageDao){var dao={};dao.list=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var startDate=$scope.startDate;var endDate=$scope.endDate;var moduleName=defaultString($scope.moduleName);var serviceName=defaultString($scope.serviceName);var errorMessage=encodeURIComponent(defaultString($scope.errorMessage));var interfaceUrl=defaultString($scope.interfaceUrl);var interfaceParam=defaultString($scope.interfaceParam);var interfaceReturnValue=encodeURIComponent(defaultString($scope.interfaceReturnValue));var url="/exceptionlog/list?pageNo="+pageNo+"&startDate="+startDate+"&endDate="+endDate;if(isNotBlank(moduleName)){url+="&moduleName="+moduleName}if(isNotBlank(serviceName)){url+="&serviceName="+serviceName}if(isNotBlank(errorMessage)){url+="&errorMessage="+errorMessage}if(isNotBlank(interfaceUrl)){url+="&interfaceUrl="+interfaceUrl}if(isNotBlank(interfaceParam)){url+="&interfaceParam="+interfaceParam}if(isNotBlank(interfaceReturnValue)){url+="&interfaceReturnValue="+interfaceReturnValue}$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}exceptionlogLists=data.records;$scope.exceptionlogs=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)}).error(function(data,status,headers,config){})};dao.show=function($scope,id){var url="/exceptionlog/show?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.exceptionlog=data.data}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};return dao});indexApp.factory("operationlogDao",function($http,pageDao){var dao={};dao.list=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var startDate=$scope.startDate;var userName=$scope.userName;var keywords=defaultString($scope.keywords);var params={pageNo:pageNo,date:startDate,userName:userName,keywords:keywords};var url="/operationlog/list?"+$.param(params);$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.operationlogs=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)}).error(function(data,status,headers,config){})};dao.show=function($scope,id){var url="/operationlog/show?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.operationlog=data.data}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};return dao});indexApp.factory("requestLogDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var startDate=$scope.startDate;var endDate=$scope.endDate;keywords=encodeURIComponent(keywords);var url="/requestlog/list?pageNo="+pageNo+"&keywords="+keywords+"&startDate="+startDate+"&endDate="+endDate;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.requestLogs=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.show=function($scope,id){var url="/requestlog/show?id="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.requestLog=data.data})};return dao});indexApp.factory("sysConfigDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var url="/sysconfig/list?pageNo="+pageNo+"&keywords="+keywords;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}sysconfigs=data.records;$scope.sysconfigs=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)}).error(function(data,status,headers,config){})};dao.add=function($scope){var aliasName=$scope.sysconfig.aliasName;var paramKey=$scope.sysconfig.paramKey;var paramValue=$scope.sysconfig.paramValue;var remark=$scope.sysconfig.remark;if(isNull(remark)){remark=""}remark=encodeURIComponent(remark);var orderNo=$scope.sysconfig.orderNo;var url="/sysconfig/add?aliasName="+aliasName+"&paramKey="+paramKey+"&paramValue="+paramValue+"&remark="+remark+"&orderNo="+orderNo;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}jDialog.alert("系统参数配置","添加成功");$location.path("sysconfig/list")}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};dao.show=function($scope,id){var url="/sysconfig/getinfo?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.sysconfig=data.data}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};dao.edit=function($scope){var id=$scope.sysconfig.id;var aliasName=$scope.sysconfig.aliasName;var paramKey=$scope.sysconfig.paramKey;var paramValue=$scope.sysconfig.paramValue;var remark=$scope.sysconfig.remark;if(isNull(remark)){remark=""}remark=encodeURIComponent(remark);var orderNo=$scope.sysconfig.orderNo;var url="/sysconfig/edit?id="+id+"&aliasName="+aliasName+"&paramKey="+paramKey+"&paramValue="+paramValue+"&remark="+remark+"&orderNo="+orderNo;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}jDialog.alert("系统参数配置","修改成功");$location.path("sysconfig/list")}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};dao.remove=function($scope,id){var url="/sysconfig/delete?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}jDialog.alert("系统参数删除","删除成功");$scope.list()}).error(function(data,status,headers,config){jDialog.alert("提示: ",data.status)})};return dao});indexApp.factory("exceptionlogService",function(exceptionlogDao){var service={};service.list=function($scope){exceptionlogDao.list($scope)};service.show=function($scope,id){exceptionlogDao.show($scope,id)};return service});indexApp.factory("operationlogService",function(operationlogDao){var service={};service.list=function($scope){operationlogDao.list($scope)};service.show=function($scope,id){operationlogDao.show($scope,id)};return service});indexApp.factory("requestLogService",function($rootScope,requestLogDao){var service={};service.validateListStartDateFail=function($scope){var $startDate=$("#startDate");var startDate=$scope.startDate;if(isBlank(startDate)){updateShowTipos($startDate,"请选择开始日期！");return true}return false};service.validateListEndDateFail=function($scope){var startDate=$scope.startDate;var $endDate=$("#endDate");var endDate=$scope.endDate;if(isBlank(endDate)){updateShowTipos($endDate,"请选择截止日期！");return true}if(endDate<startDate){updateShowTipos($endDate,"截止日期不能早于开始日期！");return true}return false};service.initTipsForListDateChange=function(){var $startDate=$("#startDate");var $endDate=$("#endDate");initTipsArray([$startDate,$endDate]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startDate,$endDate])})};service.list=function($scope){requestLogDao.list($scope)};service.show=function($scope,id){requestLogDao.show($scope,id)};return service});indexApp.factory("sysConfigService",function($rootScope,sysConfigDao){var service={};service.list=function($scope){sysConfigDao.list($scope)};service.add=function($scope){sysConfigDao.add($scope)};service.show=function($scope,id){sysConfigDao.show($scope,id)};service.edit=function($scope){sysConfigDao.edit($scope)};service.remove=function($scope,id){sysConfigDao.remove($scope,id)};service.paramValidateFail=function($scope){var $aliasName=$("input[data-ng-model='sysconfig.aliasName']");var aliasName=$scope.sysconfig.aliasName;if(isBlank(aliasName)){updateShowTipos($aliasName,"名称不能为空！");return true}var $paramKey=$("input[data-ng-model='sysconfig.paramKey']");var paramKey=$scope.sysconfig.paramKey;if(isBlank(paramKey)){updateShowTipos($paramKey,"Key不能为空！");return true}var $paramValue=$("input[data-ng-model='sysconfig.paramValue']");var paramValue=$scope.sysconfig.paramValue;if(isBlank(paramValue)){updateShowTipos($paramValue,"Value不能为空！");return true}var $orderNo=$("input[data-ng-model='sysconfig.orderNo']");var orderNo=$scope.sysconfig.orderNo;if(isBlank(orderNo)){updateShowTipos($orderNo,"排序号不能为空！");return true}if(!chkString(orderNo,defrules.orderNo)){updateShowTipos($orderNo,"排序号只能是数字形式!");return true}var $remark=$("textarea[data-ng-model='sysconfig.remark']");var remark=$scope.sysconfig.remark;if(isNotBlank(remark)&&checkLengthFail(remark,100)){updateShowTipos($remark,"备注长度不能超过100！");return true}return false};service.initTips=function(){initTips($("input[data-ng-model='sysconfig.aliasName']"));initTips($("input[data-ng-model='sysconfig.paramKey']"));initTips($("input[data-ng-model='sysconfig.paramValue']"));initTips($("input[data-ng-model='sysconfig.orderNo']"));initTips($("textarea[data-ng-model='project.remark']"));$rootScope.$on("$locationChangeStart",function(){destroyTips($("input[data-ng-model='sysconfig.aliasName']"));destroyTips($("input[data-ng-model='sysconfig.paramKey']"));destroyTips($("input[data-ng-model='sysconfig.paramValue']"));destroyTips($("input[data-ng-model='sysconfig.orderNo']"));destroyTips($("textarea[data-ng-model='project.remark']"))})};return service});indexApp.controller("deviceChartController",function($scope,$location,deviceReportService){function dateDeviceChartLine(x_date,chart_projectTotal_data,chart_sMTotal_data,chart_subTotal_data){var data_device_chart_line=echarts.init(document.getElementById("date_device_chart_line"));var data_device_chart_line_option={tooltip:{trigger:"axis"},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],legend:{orient:"horizontal",x:"right",data:[{name:"项目型",textStyle:{color:"#66CBFF"}},{name:"中小商户",textStyle:{color:"#66CC66"}},{name:"小计",textStyle:{color:"#d50000"}}]},grid:{left:40,right:40,bottom:60,containLabel:true},xAxis:[{type:"category",boundaryGap:false,data:x_date}],yAxis:[{type:"value"}],series:[{name:"项目型",type:"line",lineStyle:{normal:{color:"#66CBFF"}},data:chart_projectTotal_data},{name:"中小商户",type:"line",lineStyle:{normal:{color:"#66CC66"}},data:chart_sMTotal_data},{name:"小计",type:"line",lineStyle:{normal:{color:"#d50000"}},data:chart_subTotal_data}]};data_device_chart_line.setOption(data_device_chart_line_option)}function monthDeviceChartLine(x_date,chart_projectTotal_data,chart_sMTotal_data,chart_subTotal_data){var data_device_chart_line=echarts.init(document.getElementById("month_device_chart_line"));var data_device_chart_line_option={tooltip:{trigger:"axis"},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],legend:{orient:"horizontal",x:"right",data:[{name:"项目型",textStyle:{color:"#66CBFF"}},{name:"中小商户",textStyle:{color:"#66CC66"}},{name:"小计",textStyle:{color:"#d50000"}}]},grid:{left:40,right:40,bottom:60,containLabel:true},xAxis:[{type:"category",boundaryGap:false,data:x_date}],yAxis:[{type:"value"}],series:[{name:"项目型",type:"line",lineStyle:{normal:{color:"#66CBFF"}},data:chart_projectTotal_data},{name:"中小商户",type:"line",lineStyle:{normal:{color:"#66CC66"}},data:chart_sMTotal_data},{name:"小计",type:"line",lineStyle:{normal:{color:"#d50000"}},data:chart_subTotal_data}]};data_device_chart_line.setOption(data_device_chart_line_option)}function validateDeviceDateFail($scope){if(deviceReportService.validateDeviceStartDateFail($scope)){return true}if(deviceReportService.validateDeviceEndDateFail($scope)){return true}return false}function chartsDeviceDate(){if(validateDeviceDateFail($scope)){return}deviceReportService.chartsDeviceDate($scope,dateDeviceChartLine)}$scope.chartsDeviceDate=chartsDeviceDate;function validateDeviceMonthFail($scope){if(deviceReportService.validateDeviceStartMonthFail($scope)){return true}if(deviceReportService.validateDeviceEndMonthFail($scope)){return true}return false}function chartsDeviceMonth(){if(validateDeviceMonthFail($scope)){return}deviceReportService.chartsDeviceMonth($scope,monthDeviceChartLine)}$scope.chartsDeviceMonth=chartsDeviceMonth;function exportDeviceChartDate(){if(validateDeviceDateFail($scope)){return}deviceReportService.exportDeviceChartDate($scope)}$scope.exportDeviceChartDate=exportDeviceChartDate;function exportDeviceChartMonth(){if(validateDeviceMonthFail($scope)){return}deviceReportService.exportDeviceChartMonth($scope)}$scope.exportDeviceChartMonth=exportDeviceChartMonth;function init(){$scope.deviceDateReport={};$scope.deviceMonthReport={};var locationId=$location.search()["locationId"];$scope.locationId=locationId;var locationName=$location.search()["locationName"];$scope.locationName=locationName;var provinceId=$location.search()["provinceId"];$scope.provinceId=provinceId;var cityId=$location.search()["cityId"];$scope.cityId=cityId;var countyId=$location.search()["countyId"];$scope.countyId=countyId;var startDate=$location.search()["startDate"];var endDate=$location.search()["endDate"];$scope.deviceDateReport.startDate=startDate;$scope.deviceDateReport.endDate=endDate;$scope.deviceDateReport.oldStartDate=startDate;$scope.deviceDateReport.oldEndDate=endDate;var myDate=new Date;var str1=""+myDate.getFullYear()+"-";str1+="01";$scope.deviceMonthReport.startMonth=str1;var str2=""+myDate.getFullYear()+"-";if(myDate.getMonth()+1>=1&&myDate.getMonth()+1<10){str2+="0"+(myDate.getMonth()+1)}else{str2+=myDate.getMonth()+1}$scope.deviceMonthReport.endMonth=str2;var oldMonthHref="#/report/deviceChartDetail?statType=M&locationId="+locationId+"&locationName="+locationName+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&startDate="+str1+"&endDate="+str2+"&backStartDate="+startDate+"&backEndDate="+endDate;$("#resetMonthUrl").attr("href",oldMonthHref);$("#startDate").datepicker();$("#endDate").datepicker();$("#startMonth").datepicker({dateFormat:"yy-mm"});$("#endMonth").datepicker({dateFormat:"yy-mm"});deviceReportService.chartsDeviceDate($scope,dateDeviceChartLine);deviceReportService.chartsDeviceMonth($scope,monthDeviceChartLine);deviceReportService.initTipsForDeviceDateChange();deviceReportService.initTipsForDeviceMonthChange()}init()});indexApp.controller("deviceKeyIndexController",function($scope,$location,deviceReportService){var locationId=$location.search()["locationId"];$scope.locationId=locationId;var locationName=$location.search()["locationName"];$scope.locationName=locationName;var startDate=$location.search()["startDate"];$scope.startDate=startDate;var endDate=$location.search()["endDate"];$scope.endDate=endDate;var provinceId=$location.search()["provinceId"];$scope.provinceId=provinceId;var cityId=$location.search()["cityId"];$scope.cityId=cityId;var countyId=$location.search()["countyId"];$scope.countyId=countyId;function validateListDateFail($scope){if(deviceReportService.validateListStartDateFail($scope)){return true}if(deviceReportService.validateListEndDateFail($scope)){return true}return false}function list(){if(validateListDateFail($scope)){return}deviceReportService.deviceKeyIndexList($scope)}$scope.list=list;list();function exportKeyIndexExcle(){if(validateListDateFail($scope)){return}deviceReportService.exportKeyIndexExcle($scope)}$scope.exportKeyIndexExcle=exportKeyIndexExcle;function init(){$("#startDate").datepicker();$("#endDate").datepicker();deviceReportService.initTipsForListDateChange()}init();resetWidth();function newWidth(){var width=document.body.clientWidth;$("#reset").css("width",width-225)}newWidth()});indexApp.controller("deviceProjectReportListController",function($scope,$location,locationService,projectService,deviceReportService){var startDate=$location.search()["startDate"];$scope.startDate=startDate;var endDate=$location.search()["endDate"];$scope.endDate=endDate;var provinceId=$location.search()["provinceId"];$scope.provinceId=provinceId;var cityId=$location.search()["cityId"];$scope.cityId=cityId;var countyId=$location.search()["countyId"];$scope.countyId=countyId;function validateListDateFail($scope){if(deviceReportService.validateListStartDateFail($scope)){return true}if(deviceReportService.validateListEndDateFail($scope)){return true}return false}function list(){if(validateListDateFail($scope)){return}deviceReportService.deviceProjectReportList($scope)}$scope.list=list;list();function exportDeviceProjectExcle(){if(validateListDateFail($scope)){return}deviceReportService.exportDeviceProjectExcle($scope)}$scope.exportDeviceProjectExcle=exportDeviceProjectExcle;$scope.cityChange=function($event){var provinceId=defaultString($scope.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.cityId);locationService.countyList($scope,cityId)};function init(){$("#startDate").datepicker();$("#endDate").datepicker();locationService.provinceList($scope);deviceReportService.initTipsForListDateChange();projectService.getAllPlatformInfo($scope)}init();resetWidth()});indexApp.controller("deviceReportListController",function($scope,$location,locationService,deviceReportService,DateService){function init(){$scope.statType="D";$scope.startDate=DateService.getToday();$scope.endDate=DateService.getToday();$("#startDate").datepicker();$("#endDate").datepicker();locationService.provinceList($scope);deviceReportService.initTipsForListDateChange()}init();var myDate2=new Date;var str3=""+myDate2.getFullYear()+"-";if(myDate2.getMonth()+1>=1&&myDate2.getMonth()+1<10){str3+="0"+(myDate2.getMonth()+1)}else{str3+=myDate2.getMonth()+1}$scope.startMonth=str3;$scope.endMonth=str3;$scope.cityChange=function($event){var provinceId=defaultString($scope.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.cityId);locationService.countyList($scope,cityId)};function validateListDateFail($scope){if(deviceReportService.validateListStartDateFail($scope)){return true}if(deviceReportService.validateListEndDateFail($scope)){return true}return false}function validateListMonthFail($scope){if(deviceReportService.validateListStartMonthFail($scope)){return true}if(deviceReportService.validateListEndMonthFail($scope)){return true}return false}function deviceReportList(){if(validateListDateFail($scope)){return}deviceReportService.list($scope)}$scope.deviceReportList=deviceReportList;function exportDeviceReports(){if(validateListDateFail($scope)){return}deviceReportService.exportDeviceReports($scope)}$scope.exportDeviceReports=exportDeviceReports;function main(){deviceReportList();resetWidth()}main()});indexApp.controller("portalPVChartController",function($scope,$location,portalReportService){function datePVChartLine(x_date,chart_guidePv_data,chart_certificationPv_data,chart_transitionPv_data,chart_navigationPv_data,chart_totalPv_data){var data_PV_chart_line=echarts.init(document.getElementById("date_PV_chart_line"));var data_PV_chart_line_option={tooltip:{trigger:"axis"},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],legend:{orient:"horizontal",x:"right",data:[{name:"引导页PV",textStyle:{color:"#66CBFF"}},{name:"认证页PV",textStyle:{color:"#66CC66"}},{name:"过渡页PV",textStyle:{color:"#FF6600"}},{name:"导航页PV",textStyle:{color:"#000000"}},{name:"总页面PV",textStyle:{color:"#d50000"}}]},grid:{left:40,right:40,bottom:60,containLabel:true},xAxis:[{type:"category",boundaryGap:false,data:x_date}],yAxis:[{type:"value"}],series:[{name:"引导页PV",type:"line",lineStyle:{normal:{color:"#66CBFF"}},data:chart_guidePv_data},{name:"认证页PV",type:"line",lineStyle:{normal:{color:"#66CC66"}},data:chart_certificationPv_data},{name:"过渡页PV",type:"line",lineStyle:{normal:{color:"#FF6600"}},data:chart_transitionPv_data},{name:"导航页PV",type:"line",lineStyle:{normal:{color:"#000000"}},data:chart_navigationPv_data},{name:"总页面PV",type:"line",lineStyle:{normal:{color:"#d50000"}},data:chart_totalPv_data}]};data_PV_chart_line.setOption(data_PV_chart_line_option)}function monthPVChartLine(x_date,chart_guidePv_data,chart_certificationPv_data,chart_transitionPv_data,chart_navigationPv_data,chart_totalPv_data){var data_PV_chart_line=echarts.init(document.getElementById("month_PV_chart_line"));var data_PV_chart_line_option={tooltip:{trigger:"axis"},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],legend:{orient:"horizontal",x:"right",data:[{name:"引导页PV",textStyle:{color:"#66CBFF"}},{name:"认证页PV",textStyle:{color:"#66CC66"}},{name:"过渡页PV",textStyle:{color:"#FF6600"}},{name:"导航页PV",textStyle:{color:"#000000"}},{name:"总页面PV",textStyle:{color:"#d50000"}}]},grid:{left:40,right:40,bottom:60,containLabel:true},xAxis:[{type:"category",boundaryGap:false,data:x_date}],yAxis:[{type:"value"}],series:[{name:"引导页PV",type:"line",lineStyle:{normal:{color:"#66CBFF"}},data:chart_guidePv_data},{name:"认证页PV",type:"line",lineStyle:{normal:{color:"#66CC66"}},data:chart_certificationPv_data},{name:"过渡页PV",type:"line",lineStyle:{normal:{color:"#FF6600"}},data:chart_transitionPv_data},{name:"导航页PV",type:"line",lineStyle:{normal:{color:"#000000"}},data:chart_navigationPv_data},{name:"总页面PV",type:"line",lineStyle:{normal:{color:"#d50000"}},data:chart_totalPv_data}]};data_PV_chart_line.setOption(data_PV_chart_line_option)}function validatePVDateFail($scope){if(portalReportService.validatePVStartDateFail($scope)){return true}if(portalReportService.validatePVEndDateFail($scope)){return true}return false}function portalPVDate(){if(validatePVDateFail($scope)){return}portalReportService.chartsPVDate($scope,datePVChartLine)}$scope.chartsPVDate=portalPVDate;function validatePVMonthFail($scope){if(portalReportService.validatePVStartMonthFail($scope)){return true}if(portalReportService.validatePVEndMonthFail($scope)){return true}return false}function portalPVMonth(){if(validatePVMonthFail($scope)){return}portalReportService.chartPVMonth($scope,monthPVChartLine)}$scope.chartPVMonth=portalPVMonth;function exportPortalDateDetail(){if(validatePVDateFail($scope)){return}portalReportService.exportPortalDateDetail($scope)}$scope.exportPortalDateDetail=exportPortalDateDetail;function exportPortalMonthDetail(){if(validatePVMonthFail($scope)){return}portalReportService.exportPortalMonthDetail($scope)}$scope.exportPortalMonthDetail=exportPortalMonthDetail;function init(){$scope.PVDateReport={};$scope.PVMonthReport={};var locationId=$location.search()["locationId"];$scope.locationId=locationId;var locationName=$location.search()["locationName"];$scope.locationName=locationName;var platformId=$location.search()["platformId"];$scope.platformId=platformId;var projectName=$location.search()["projectName"];$scope.projectName=projectName;var provinceId=$location.search()["provinceId"];$scope.provinceId=provinceId;var cityId=$location.search()["cityId"];$scope.cityId=cityId;var countyId=$location.search()["countyId"];$scope.countyId=countyId;var entityType=$location.search()["entityType"];$scope.entityType=entityType;var myDate=new Date;var str1=""+myDate.getFullYear()+"-";str1+="01";$scope.PVMonthReport.startMonth=str1;var str2=""+myDate.getFullYear()+"-";if(myDate.getMonth()+1>=1&&myDate.getMonth()+1<10){str2+="0"+(myDate.getMonth()+1)}else{str2+=myDate.getMonth()+1}$scope.PVMonthReport.endMonth=str2;var startDate=$location.search()["startDate"];var endDate=$location.search()["endDate"];$scope.PVDateReport.startDate=startDate;$scope.PVDateReport.endDate=endDate;$("#startDate").datepicker();$("#endDate").datepicker();$("#startMonth").datepicker({dateFormat:"yy-mm"});$("#endMonth").datepicker({dateFormat:"yy-mm"});portalReportService.chartsPVDate($scope,datePVChartLine);portalReportService.chartPVMonth($scope,monthPVChartLine);portalReportService.initTipsForPVDateChange();portalReportService.initTipsForPVMonthChange()}init()});indexApp.controller("portalReportListController",function($scope,$location,locationService,projectService,portalReportService,DateService){function init(){$scope.startDate=DateService.getYesterday();$scope.endDate=DateService.getYesterday();$(".navs").on("click","li",function(e){var $el=$(this);var idx=$el.index();$el.parent().find(".active").removeClass("active");$el.addClass("active");var $panel=$(".nav-panel").hide().eq(idx).show();$panel.trigger("fninit");var panelId=$panel.attr("id");if(panelId=="portalReportPV01"){$("#portalReportPV001").show();$("#portalReportUV001").hide()}else if(panelId=="portalReportUV01"){$("#portalReportUV001").show();$("#portalReportPV001").hide()}});$("#startDate").datepicker();$("#endDate").datepicker();projectService.getAllPlatformInfo($scope);locationService.provinceList($scope);portalReportService.initTipsForListDateChange()}init();$scope.cityChange=function($event){var provinceId=defaultString($scope.provinceId);locationService.cityList($scope,provinceId)};$scope.countyChange=function($event){var cityId=defaultString($scope.cityId);locationService.countyList($scope,cityId)};function validateListDateFail($scope){if(portalReportService.validateListStartDateFail($scope)){return true}if(portalReportService.validateListEndDateFail($scope)){return true}return false}function portalReportList(){if(validateListDateFail($scope)){return}portalReportService.list($scope)}$scope.portalReportList=portalReportList;portalReportList();function exportPortalReports(){if(validateListDateFail($scope)){return}portalReportService.exportPortalReports($scope)}$scope.exportPortalReports=exportPortalReports;function newWidth(){var h=$(".content-portalReport");var listWidth=h.outerWidth(true);$(".listtitle").css("width",listWidth-20)}function main(){newWidth()}main()});indexApp.controller("portalUVChartController",function($scope,$location,portalReportService){function dateUVChartLine(x_date,chart_guideUv_data,chart_certificationUv_data,chart_transitionUv_data,chart_navigationUv_data,chart_totalUv_data){var data_UV_chart_line=echarts.init(document.getElementById("date_UV_chart_line"));var data_UV_chart_line_option={tooltip:{trigger:"axis"},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],legend:{orient:"horizontal",x:"right",data:[{name:"引导页UV",textStyle:{color:"#66CBFF"}},{name:"认证页UV",textStyle:{color:"#66CC66"}},{name:"过渡页UV",textStyle:{color:"#FF6600"}},{name:"导航页UV",textStyle:{color:"#000000"}},{name:"总页面UV",textStyle:{color:"#d50000"}}]},grid:{left:40,right:40,bottom:60,containLabel:true},xAxis:[{type:"category",boundaryGap:false,data:x_date}],yAxis:[{type:"value"}],series:[{name:"引导页UV",type:"line",lineStyle:{normal:{color:"#66CBFF"}},data:chart_guideUv_data},{name:"认证页UV",type:"line",lineStyle:{normal:{color:"#66CC66"}},data:chart_certificationUv_data},{name:"过渡页UV",type:"line",lineStyle:{normal:{color:"#FF6600"}},data:chart_transitionUv_data},{name:"导航页UV",type:"line",lineStyle:{normal:{color:"#000000"}},data:chart_navigationUv_data},{name:"总页面UV",type:"line",lineStyle:{normal:{color:"#d50000"}},data:chart_totalUv_data}]};data_UV_chart_line.setOption(data_UV_chart_line_option)}function monthUVChartLine(x_date,chart_guideUv_data,chart_certificationUv_data,chart_transitionUv_data,chart_navigationUv_data,chart_totalUv_data){var data_UV_chart_line=echarts.init(document.getElementById("month_UV_chart_line"));var data_UV_chart_line_option={tooltip:{trigger:"axis"},dataZoom:[{show:true,realtime:true,start:0,end:100},{type:"inside",realtime:true,start:0,end:100}],legend:{orient:"horizontal",x:"right",data:[{name:"引导页UV",textStyle:{color:"#66CBFF"}},{name:"认证页UV",textStyle:{color:"#66CC66"}},{name:"过渡页UV",textStyle:{color:"#FF6600"}},{name:"导航页UV",textStyle:{color:"#000000"}},{name:"总页面UV",textStyle:{color:"#d50000"}}]},grid:{left:40,right:40,bottom:60,containLabel:true},xAxis:[{type:"category",boundaryGap:false,data:x_date}],yAxis:[{type:"value"}],series:[{name:"引导页UV",type:"line",lineStyle:{normal:{color:"#66CBFF"}},data:chart_guideUv_data},{name:"认证页UV",type:"line",lineStyle:{normal:{color:"#66CC66"}},data:chart_certificationUv_data},{name:"过渡页UV",type:"line",lineStyle:{normal:{color:"#FF6600"}},data:chart_transitionUv_data},{name:"导航页UV",type:"line",lineStyle:{normal:{color:"#000000"}},data:chart_navigationUv_data},{name:"总页面UV",type:"line",lineStyle:{normal:{color:"#d50000"}},data:chart_totalUv_data}]};data_UV_chart_line.setOption(data_UV_chart_line_option)}function validateUVDateFail($scope){if(portalReportService.validateUVStartDateFail($scope)){return true}if(portalReportService.validateUVEndDateFail($scope)){return true}return false}function portalUVDate(){if(validateUVDateFail($scope)){return}portalReportService.chartsUVDate($scope,dateUVChartLine)}$scope.chartsUVDate=portalUVDate;function validateUVMonthFail($scope){if(portalReportService.validateUVStartMonthFail($scope)){
return true}if(portalReportService.validateUVEndMonthFail($scope)){return true}return false}function portalUVMonth(){if(validateUVMonthFail($scope)){return}portalReportService.chartUVMonth($scope,monthUVChartLine)}$scope.chartUVMonth=portalUVMonth;function exportPortalDateDetail(){if(validateUVDateFail($scope)){return}portalReportService.exportPortalDateDetail($scope)}$scope.exportPortalDateDetail=exportPortalDateDetail;function exportPortalMonthDetail(){if(validateUVMonthFail($scope)){return}portalReportService.exportPortalMonthDetail($scope)}$scope.exportPortalMonthDetail=exportPortalMonthDetail;function init(){$scope.UVDateReport={};$scope.UVMonthReport={};var locationId=$location.search()["locationId"];$scope.locationId=locationId;var locationName=$location.search()["locationName"];$scope.locationName=locationName;var platformId=$location.search()["platformId"];$scope.platformId=platformId;var projectName=$location.search()["projectName"];$scope.projectName=projectName;var provinceId=$location.search()["provinceId"];$scope.provinceId=provinceId;var cityId=$location.search()["cityId"];$scope.cityId=cityId;var countyId=$location.search()["countyId"];$scope.countyId=countyId;var entityType=$location.search()["entityType"];$scope.entityType=entityType;var myDate=new Date;var str1=""+myDate.getFullYear()+"-";str1+="01";$scope.UVMonthReport.startMonth=str1;var str2=""+myDate.getFullYear()+"-";if(myDate.getMonth()+1>=1&&myDate.getMonth()+1<10){str2+="0"+(myDate.getMonth()+1)}else{str2+=myDate.getMonth()+1}$scope.UVMonthReport.endMonth=str2;var startDate=$location.search()["startDate"];var endDate=$location.search()["endDate"];$scope.UVDateReport.startDate=startDate;$scope.UVDateReport.endDate=endDate;$("#startDate").datepicker();$("#endDate").datepicker();$("#startMonth").datepicker({dateFormat:"yy-mm"});$("#endMonth").datepicker({dateFormat:"yy-mm"});portalReportService.chartsUVDate($scope,dateUVChartLine);portalReportService.chartUVMonth($scope,monthUVChartLine);portalReportService.initTipsForUVDateChange();portalReportService.initTipsForUVMonthChange()}init()});indexApp.factory("deviceReportDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){loadingAppend();var startDate=defaultString($scope.startDate);var endDate=defaultString($scope.endDate);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(countyId)){countyId=""}var url="/devicereport/list?startDate="+startDate+"&endDate="+endDate+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.deviceReports=data.devicesList;$scope.totalDevices=data.totalDevices;$scope.oldStartDate=$scope.startDate;$scope.oldendDate=$scope.endDate;$scope.oldProvinceId=$scope.provinceId;$scope.oldCityId=$scope.cityId;$scope.oldCountyId=$scope.countyId})};dao.exportDeviceReports=function($scope){$("#exportExcle").submit()};function commafy(num){num=num+"";var re=/(-?\d+)(\d{3})/;while(re.test(num)){num=num.replace(re,"$1,$2")}return num}dao.chartsDeviceDate=function($scope,funDeviceDateLine){loadingAppend();var statType="D";var locationId=$scope.locationId;var startDate=defaultString($scope.deviceDateReport.startDate);var endDate=defaultString($scope.deviceDateReport.endDate);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(countyId)){countyId=""}var url="/devicereport/chart?statType="+statType+"&locationId="+locationId+"&startDate="+startDate+"&endDate="+endDate+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId;$http.get(url).success(function(resp){loadingRemove();if(resp.result=="FAIL"){jDialog.alert("提示：",resp.message);return}var x_date=resp.x_date,chart_projectTotal_data=resp.projectTotal,chart_sMTotal_data=resp.sMTotal,chart_subTotal_data=resp.subTotal;funDeviceDateLine(x_date,chart_projectTotal_data,chart_sMTotal_data,chart_subTotal_data)})};dao.chartsDeviceMonth=function($scope,funDeviceMonthLine){loadingAppend();var statType="M";var locationId=$scope.locationId;var startDate=defaultString($scope.deviceMonthReport.startMonth);var endDate=defaultString($scope.deviceMonthReport.endMonth);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(countyId)){countyId=""}var url="/devicereport/chart?statType="+statType+"&locationId="+locationId+"&startDate="+startDate+"&endDate="+endDate+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId;$http.get(url).success(function(resp){loadingRemove();if(resp.result=="FAIL"){jDialog.alert("提示：",resp.message);return}var x_date=resp.x_date,chart_projectTotal_data=resp.projectTotal,chart_sMTotal_data=resp.sMTotal,chart_subTotal_data=resp.subTotal;funDeviceMonthLine(x_date,chart_projectTotal_data,chart_sMTotal_data,chart_subTotal_data)})};dao.exportDeviceChartDate=function($scope){$("#exportDeviceChartDate").submit()};dao.exportDeviceChartMonth=function($scope){$("#exportDeviceChartMonth").submit()};dao.deviceKeyIndexList=function($scope){loadingAppend();var locationId=$scope.locationId;var startDate=defaultString($scope.startDate);var endDate=defaultString($scope.endDate);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(countyId)){countyId=""}var url="/devicereport/keyindex?locationId="+locationId+"&startDate="+startDate+"&endDate="+endDate+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.deviceKeyIndexs=data.devicesList;$scope.begin=data.begin;$scope.data=data})};dao.exportKeyIndexExcle=function($scope){$("#exportKeyIndexExcle").submit()};dao.deviceProjectReportList=function($scope){loadingAppend();var startDate=defaultString($scope.startDate);var endDate=defaultString($scope.endDate);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;var platformId=$scope.platformId;var projectName=defaultString($scope.projectName);if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(countyId)){countyId=""}if(isBlank(platformId)){platformId=""}projectName=encodeURIComponent(projectName);var url="/devicereport/projectreportlist?startDate="+startDate+"&endDate="+endDate+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&platformId="+platformId+"&projectName="+projectName;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.deviceProjectReports=data.DeviceTypeStatisticsList;$scope.DeviceTypeStatisticsSum=data.DeviceTypeStatisticsSum})};dao.exportDeviceProjectExcle=function($scope){$("#exportDeviceProjectExcle").submit()};return dao});indexApp.factory("portalReportDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){loadingAppend();var startDate=defaultString($scope.startDate);var endDate=defaultString($scope.endDate);var entityType=$scope.entityType;var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;var platformId=$scope.platformId;var projectName=defaultString($scope.projectName);if(isBlank(provinceId)){provinceId=""}if(isBlank(cityId)){cityId=""}if(isBlank(countyId)){countyId=""}if(isBlank(platformId)){platformId=""}if(isBlank(entityType)){entityType=""}projectName=encodeURIComponent(projectName);entityType=encodeURIComponent(entityType);var url="/portalreport/list?startDate="+startDate+"&endDate="+endDate+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&entityType="+entityType+"&platformId="+platformId+"&projectName="+projectName;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}portalReports=data.pvuvList;$scope.portalReports=data.pvuvList;$scope.totalPortals=data.totailPvUv;$scope.oldStartDate=$scope.startDate;$scope.oldendDate=$scope.endDate;$scope.oldEntityType=$scope.entityType;$scope.oldPlatformId=$scope.platformId;$scope.oldProjectName=$scope.projectName;$scope.oldProvinceId=$scope.provinceId;$scope.oldCityId=$scope.cityId;$scope.oldCountyId=$scope.countyId})};dao.exportPortalReports=function($scope){$("#exportExcle").submit()};function commafy(num){num=num+"";var re=/(-?\d+)(\d{3})/;while(re.test(num)){num=num.replace(re,"$1,$2")}return num}dao.chartsPVDate=function($scope,funPVDateLine){loadingAppend();var statType="D";var locationId=$scope.locationId;var startDate=defaultString($scope.PVDateReport.startDate);var endDate=defaultString($scope.PVDateReport.endDate);var platformId=$scope.platformId;var projectName=defaultString($scope.projectName);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;var entityType=$scope.entityType;projectName=encodeURIComponent(projectName);entityType=encodeURIComponent(entityType);var url="/portalreport/trend?statType="+statType+"&locationId="+locationId+"&startDate="+startDate+"&endDate="+endDate+"&platformId="+platformId+"&projectName="+projectName+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&entityType="+entityType;$http.get(url).success(function(resp){loadingRemove();if(resp.result=="FAIL"){jDialog.alert("提示：",resp.message);return}var x_date=resp.x_date,chart_guidePv_data=resp.guidePv,chart_certificationPv_data=resp.certificationPv,chart_transitionPv_data=resp.transitionPv,chart_navigationPv_data=resp.navigationPv,chart_totalPv_data=resp.totalPv;funPVDateLine(x_date,chart_guidePv_data,chart_certificationPv_data,chart_transitionPv_data,chart_navigationPv_data,chart_totalPv_data)})};dao.chartPVMonth=function($scope,funPVMonthLine){loadingAppend();var statType="M";var locationId=$scope.locationId;var startDate=defaultString($scope.PVMonthReport.startMonth);var endDate=defaultString($scope.PVMonthReport.endMonth);var platformId=$scope.platformId;var projectName=defaultString($scope.projectName);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;var entityType=$scope.entityType;projectName=encodeURIComponent(projectName);entityType=encodeURIComponent(entityType);var url="/portalreport/trend?statType="+statType+"&locationId="+locationId+"&startDate="+startDate+"&endDate="+endDate+"&platformId="+platformId+"&projectName="+projectName+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&entityType="+entityType;$http.get(url).success(function(resp){loadingRemove();if(resp.result=="FAIL"){jDialog.alert("提示：",resp.message);return}var x_date=resp.x_date,chart_guidePv_data=resp.guidePv,chart_certificationPv_data=resp.certificationPv,chart_transitionPv_data=resp.transitionPv,chart_navigationPv_data=resp.navigationPv,chart_totalPv_data=resp.totalPv;funPVMonthLine(x_date,chart_guidePv_data,chart_certificationPv_data,chart_transitionPv_data,chart_navigationPv_data,chart_totalPv_data)})};dao.chartsUVDate=function($scope,funUVDateLine){loadingAppend();var statType="D";var locationId=$scope.locationId;var startDate=defaultString($scope.UVDateReport.startDate);var endDate=defaultString($scope.UVDateReport.endDate);var platformId=$scope.platformId;var projectName=defaultString($scope.projectName);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;var entityType=$scope.entityType;projectName=encodeURIComponent(projectName);entityType=encodeURIComponent(entityType);var url="/portalreport/trend?statType="+statType+"&locationId="+locationId+"&startDate="+startDate+"&endDate="+endDate+"&platformId="+platformId+"&projectName="+projectName+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&entityType="+entityType;$http.get(url).success(function(resp){loadingRemove();if(resp.result=="FAIL"){jDialog.alert("提示：",resp.message);return}var x_date=resp.x_date,chart_guideUv_data=resp.guideUv,chart_certificationUv_data=resp.certificationUv,chart_transitionUv_data=resp.transitionUv,chart_navigationUv_data=resp.navigationUv,chart_totalUv_data=resp.totalUv;funUVDateLine(x_date,chart_guideUv_data,chart_certificationUv_data,chart_transitionUv_data,chart_navigationUv_data,chart_totalUv_data)})};dao.chartUVMonth=function($scope,funUVMonthLine){loadingAppend();var statType="M";var locationId=$scope.locationId;var startDate=defaultString($scope.UVMonthReport.startMonth);var endDate=defaultString($scope.UVMonthReport.endMonth);var platformId=$scope.platformId;var projectName=defaultString($scope.projectName);var provinceId=$scope.provinceId;var cityId=$scope.cityId;var countyId=$scope.countyId;var entityType=$scope.entityType;projectName=encodeURIComponent(projectName);entityType=encodeURIComponent(entityType);var url="/portalreport/trend?statType="+statType+"&locationId="+locationId+"&startDate="+startDate+"&endDate="+endDate+"&platformId="+platformId+"&projectName="+projectName+"&provinceId="+provinceId+"&cityId="+cityId+"&countyId="+countyId+"&entityType="+entityType;$http.get(url).success(function(resp){loadingRemove();if(resp.result=="FAIL"){jDialog.alert("提示：",resp.message);return}var x_date=resp.x_date,chart_guideUv_data=resp.guideUv,chart_certificationUv_data=resp.certificationUv,chart_transitionUv_data=resp.transitionUv,chart_navigationUv_data=resp.navigationUv,chart_totalUv_data=resp.totalUv;funUVMonthLine(x_date,chart_guideUv_data,chart_certificationUv_data,chart_transitionUv_data,chart_navigationUv_data,chart_totalUv_data)})};dao.exportPortalDateDetail=function($scope){$("#exportPortalDateDetail").submit()};dao.exportPortalMonthDetail=function($scope){$("#exportPortalMonthDetail").submit()};return dao});indexApp.factory("deviceReportService",function($rootScope,deviceReportDao){var service={};service.validateListStartDateFail=function($scope){var $startDate=$("#startDate");var startDate=$scope.startDate;if(isBlank(startDate)){updateShowTipos($startDate,"请选择开始日期！");return true}return false};service.validateListEndDateFail=function($scope){var startDate=$scope.startDate;var $endDate=$("#endDate");var endDate=$scope.endDate;if(isBlank(endDate)){updateShowTipos($endDate,"请选择截止日期！");return true}if(endDate<startDate){updateShowTipos($endDate,"截止日期不能早于开始日期！");return true}return false};service.initTipsForListDateChange=function(){var $startDate=$("#startDate");var $endDate=$("#endDate");initTipsArray([$startDate,$endDate]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startDate,$endDate])})};service.validateDeviceStartDateFail=function($scope){var $startDate=$("#startDate");var startDate=$scope.deviceDateReport.startDate;if(isBlank(startDate)){updateShowTipos($startDate,"请选择开始日期！");return true}return false};service.validateDeviceEndDateFail=function($scope){var startDate=$scope.deviceDateReport.startDate;var $endDate=$("#endDate");var endDate=$scope.deviceDateReport.endDate;if(isBlank(endDate)){updateShowTipos($endDate,"请选择截止日期！");return true}if(endDate<startDate){updateShowTipos($endDate,"截止日期不能早于开始日期！");return true}return false};service.initTipsForDeviceDateChange=function(){var $startDate=$("#startDate");var $endDate=$("#endDate");initTipsArray([$startDate,$endDate]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startDate,$endDate])})};service.validateDeviceStartMonthFail=function($scope){var $startMonth=$("#startMonth");var startMonth=$scope.deviceMonthReport.startMonth;if(isBlank(startMonth)){updateShowTipos($startMonth,"请选择开始日期！");return true}return false};service.validateDeviceEndMonthFail=function($scope){var startMonth=$scope.deviceMonthReport.startMonth;var $endMonth=$("#endMonth");var endMonth=$scope.deviceMonthReport.endMonth;if(isBlank(endMonth)){updateShowTipos($endMonth,"请选择截止日期！");return true}if(endMonth<startMonth){updateShowTipos($endMonth,"截止日期不能早于开始日期！");return true}return false};service.initTipsForDeviceMonthChange=function(){var $startMonth=$("#startMonth");var $endMonth=$("#endMonth");initTipsArray([$startMonth,$endMonth]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startMonth,$endMonth])})};service.list=function($scope){deviceReportDao.list($scope)};service.exportDeviceReports=function($scope){deviceReportDao.exportDeviceReports($scope)};service.chartsDeviceDate=deviceReportDao.chartsDeviceDate;service.chartsDeviceMonth=deviceReportDao.chartsDeviceMonth;service.exportDeviceChartDate=function($scope){deviceReportDao.exportDeviceChartDate($scope)};service.exportDeviceChartMonth=function($scope){deviceReportDao.exportDeviceChartMonth($scope)};service.deviceKeyIndexList=function($scope){deviceReportDao.deviceKeyIndexList($scope)};service.exportKeyIndexExcle=function($scope){deviceReportDao.exportKeyIndexExcle($scope)};service.deviceProjectReportList=function($scope){deviceReportDao.deviceProjectReportList($scope)};service.exportDeviceProjectExcle=function($scope){deviceReportDao.exportDeviceProjectExcle($scope)};return service});indexApp.factory("portalReportService",function($rootScope,portalReportDao){var service={};service.validateListStartDateFail=function($scope){var $startDate=$("#startDate");var startDate=$scope.startDate;if(isBlank(startDate)){updateShowTipos($startDate,"请选择开始日期！");return true}return false};service.validateListEndDateFail=function($scope){var startDate=$scope.startDate;var $endDate=$("#endDate");var endDate=$scope.endDate;if(isBlank(endDate)){updateShowTipos($endDate,"请选择截止日期！");return true}if(endDate<startDate){updateShowTipos($endDate,"截止日期不能早于开始日期！");return true}return false};service.initTipsForListDateChange=function(){var $startDate=$("#startDate");var $endDate=$("#endDate");initTipsArray([$startDate,$endDate]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startDate,$endDate])})};service.validatePVStartDateFail=function($scope){var $startDate=$("#startDate");var startDate=$scope.PVDateReport.startDate;if(isBlank(startDate)){updateShowTipos($startDate,"请选择开始日期！");return true}return false};service.validatePVEndDateFail=function($scope){var startDate=$scope.PVDateReport.startDate;var $endDate=$("#endDate");var endDate=$scope.PVDateReport.endDate;if(isBlank(endDate)){updateShowTipos($endDate,"请选择截止日期！");return true}if(endDate<startDate){updateShowTipos($endDate,"截止日期不能早于开始日期！");return true}return false};service.initTipsForPVDateChange=function(){var $startDate=$("#startDate");var $endDate=$("#endDate");initTipsArray([$startDate,$endDate]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startDate,$endDate])})};service.validatePVStartMonthFail=function($scope){var $startMonth=$("#startMonth");var startMonth=$scope.PVMonthReport.startMonth;if(isBlank(startMonth)){updateShowTipos($startMonth,"请选择开始日期！");return true}return false};service.validatePVEndMonthFail=function($scope){var startMonth=$scope.PVMonthReport.startMonth;var $endMonth=$("#endMonth");var endMonth=$scope.PVMonthReport.endMonth;if(isBlank(endMonth)){updateShowTipos($endMonth,"请选择截止日期！");return true}if(endMonth<startMonth){updateShowTipos($endMonth,"截止日期不能早于开始日期！");return true}return false};service.initTipsForPVMonthChange=function(){var $startMonth=$("#startMonth");var $endMonth=$("#endMonth");initTipsArray([$startMonth,$endMonth]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startMonth,$endMonth])})};service.validateUVStartDateFail=function($scope){var $startDate=$("#startDate");var startDate=$scope.UVDateReport.startDate;if(isBlank(startDate)){updateShowTipos($startDate,"请选择开始日期！");return true}return false};service.validateUVEndDateFail=function($scope){var startDate=$scope.UVDateReport.startDate;var $endDate=$("#endDate");var endDate=$scope.UVDateReport.endDate;if(isBlank(endDate)){updateShowTipos($endDate,"请选择截止日期！");return true}if(endDate<startDate){updateShowTipos($endDate,"截止日期不能早于开始日期！");return true}return false};service.initTipsForUVDateChange=function(){var $startDate=$("#startDate");var $endDate=$("#endDate");initTipsArray([$startDate,$endDate]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startDate,$endDate])})};service.validateUVStartMonthFail=function($scope){var $startMonth=$("#startMonth");var startMonth=$scope.UVMonthReport.startMonth;if(isBlank(startMonth)){updateShowTipos($startMonth,"请选择开始日期！");return true}return false};service.validateUVEndMonthFail=function($scope){var startMonth=$scope.UVMonthReport.startMonth;var $endMonth=$("#endMonth");var endMonth=$scope.UVMonthReport.endMonth;if(isBlank(endMonth)){updateShowTipos($endMonth,"请选择截止日期！");return true}if(endMonth<startMonth){updateShowTipos($endMonth,"截止日期不能早于开始日期！");return true}return false};service.initTipsForUVMonthChange=function(){var $startMonth=$("#startMonth");var $endMonth=$("#endMonth");initTipsArray([$startMonth,$endMonth]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$startMonth,$endMonth])})};service.list=function($scope){portalReportDao.list($scope)};service.chartsPVDate=portalReportDao.chartsPVDate;service.chartPVMonth=portalReportDao.chartPVMonth;service.chartsUVDate=portalReportDao.chartsUVDate;service.chartUVMonth=portalReportDao.chartUVMonth;service.exportPortalReports=function($scope){portalReportDao.exportPortalReports($scope)};service.exportPortalDateDetail=function($scope){portalReportDao.exportPortalDateDetail($scope)};service.exportPortalMonthDetail=function($scope){portalReportDao.exportPortalMonthDetail($scope)};return service});indexApp.controller("noperceptionAddController",function($scope,customerService,noperceptionService){function init(){customerService.customerSelect2("customerName");noperceptionService.initTips()}init();$scope.dateType=0;$scope.time=0;$scope.noperceptionAdd=function(){if(noperceptionService.validateNoperceptionFail($scope,"add")){return}noperceptionService.noperceptionAdd($scope)}});indexApp.controller("noperceptionEditController",function($scope,$location,noperceptionService){var id=$location.search()["id"];function init(){noperceptionService.initTips();noperceptionService.noperceptionShow($scope,id)}init();$scope.noperceptionEdit=function(){if(noperceptionService.validateNoperceptionFail($scope,"edit")){return}noperceptionService.noperceptionEdit($scope,id)}});indexApp.controller("noperceptionListController",function($scope,customerService,noperceptionService){function list(){noperceptionService.noperceptionList($scope)}$scope.list=list;function init(){customerService.customerSelect2();resetWidth();list()}init();$scope.selectAll=function(){var checkboxAll=$(':checkbox[name="checkboxAll"]');var checkboxItems=$(':checkbox[name="checkboxItem"]');if(checkboxAll.prop("checked")){checkboxItems.prop("checked",true)}else{checkboxItems.prop("checked",false)}};function getCheckboxVaules(){var checkboxValues=[];var checkboxItems=$(':checkbox[name="checkboxItem"]');checkboxItems.each(function(){var that=$(this);if(that.prop("checked")){checkboxValues.push($(this).val())}});return checkboxValues}$scope.noperceptionClose=function(){var checkboxValues=getCheckboxVaules();if(checkboxValues.length==0){jDialog.alert("关闭无感知","您未选择要关闭无感知的数据！请选择");return}noperceptionService.noperceptionClose($scope,checkboxValues.join(","))};$scope.noperceptionOpen=function(){var checkboxValues=getCheckboxVaules();if(checkboxValues.length==0){jDialog.alert("开启无感知","您未选择要开启无感知的数据！请选择");return}noperceptionService.noperceptionOpen($scope,checkboxValues.join(","))}});indexApp.controller("noperceptionShowController",function($scope,$location,noperceptionService){var id=$location.search()["id"];noperceptionService.noperceptionShow($scope,id)});indexApp.controller("themeAddController",function($scope,themeService){function validateFail($scope){if(themeService.validateNameForThemeFail($scope)){return true}if(themeService.validateVersionForThemeFail($scope)){return true}if(themeService.validateThumbPicForThemeFail($scope)){return true}if(themeService.validateThemeZipForThemeFail($scope)){return true}return false}function themeAdd(){if(validateFail($scope)){return}themeService.themeAdd($scope)}$scope.themeAdd=themeAdd;function init(){$scope.theme={};themeService.initTipsForThemeChange($scope)}init()});indexApp.controller("themeEditController",function($scope,$location,themeService){function validateFail($scope){if(themeService.validateNameForThemeFail($scope)){return true}if(themeService.validateVersionForThemeFail($scope)){return true}if(themeService.validateThemeZipForThemeOfEditFail($scope)){return true}if(themeService.validateThumbPicForThemeOfEditFail($scope)){return true}return false}function themeEdit(){if(validateFail($scope)){return}themeService.themeEdit($scope)}$scope.themeEdit=themeEdit;function init(){var id=$location.search()["id"];themeService.themeById($scope,id);themeService.initTipsForThemeChange($scope)}init()});indexApp.controller("themeListController",function($scope,themeService){function list(){themeService.themeList($scope)}$scope.list=list;list();$scope.deleteTheme=function(id){jDialog.confirm("删除皮肤",'<div class="rows"><label class="w100">您确定要删除该皮肤吗？</label></div>',function(){themeService.deleteStrategy($scope,id);jDialog.hide()})}});indexApp.controller("themeStrategyAddController",function($scope,themeService,customerService){function validateFail($scope){if(themeService.validateCustomerIdAndLevelForThemeStrategyFail($scope)){return true}if(themeService.validateThemeIdForThemeStrategyFail($scope)){return true}if(themeService.validateThemeTypeForThemeStrategyFail($scope)){return true}if(themeService.validateContentForThemeStrategyFail($scope)){return true}return false}$scope.themeStrategyAdd=function(){if(validateFail($scope)){return}themeService.themeStrategyAdd($scope)};function init(){$scope.themeStrategy={};themeService.themeSelectList($scope);themeService.initTipsForThemeStrategyChange();customerService.customerSelect2("customerIdAndLevel")}init()});indexApp.controller("themeStrategyEditController",function($scope,$location,themeService,customerService){function validateFail($scope){if(themeService.validateThemeIdForThemeStrategyFail($scope)){return true}if(themeService.validateThemeTypeForThemeStrategyFail($scope)){return true}if(themeService.validateContentForThemeStrategyFail($scope)){return true}return false}function themeStrategyEdit(){if(validateFail($scope)){return}themeService.themeStrategyEdit($scope)}$scope.themeStrategyEdit=themeStrategyEdit;function init(){var id=$location.search()["id"];themeService.themeSelectList($scope);themeService.themeStrategyById($scope,id);themeService.initTipsForThemeStrategyChange();customerService.customerSelect2("customerIdAndLevel")}init()});indexApp.controller("themeStrategyListController",function($scope,themeService,customerService){function init(){customerService.customerSelect2("customerIdAndLevel");themeService.themeSelectList($scope)}init();function list(){themeService.themeStrategyList($scope)}$scope.list=list;list();$scope.deleteStrategy=function(id){jDialog.confirm("删除皮肤策略",'<div class="rows"><label class="w100">您确定要删除该推送策略吗？</label></div>',function(){themeService.deleteStrategy($scope,id);jDialog.hide()})};resetWidth()});indexApp.factory("industryDao",function($http,$location,pageDao){var dao={};dao.industry1List=function($scope,parentId){parentId=defaultString(parentId);var url="/industry/list?parentId="+parentId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.industry1s=data.data})};dao.industry2List=function($scope,industryId1){var url="/industry/list?parentId="+industryId1;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.industry2s=data.data})};return dao});indexApp.factory("locationDao",function($http,$location,pageDao){var dao={};dao.provinceList=function($scope){var url="/location/province";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.provinces=data.data})};dao.cityList=function($scope,provinceId){var url="/location/city?parentId="+provinceId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.citys=data.data})};dao.countyList=function($scope,cityId){var url="/location/county?parentId="+cityId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.countys=data.data})};return dao});indexApp.factory("noperceptionDao",function($http,$location,pageDao){var dao={};dao.noperceptionList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var customerName=defaultString($scope.customerName);var customerId=customerName.split("#")?customerName.split("#")[0]:"";var params={pageNo:pageNo,customerId:customerId};var url="/noperception/list?"+$.param(params);$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.noperceptions=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)}).error(function(data,status,headers,config){jDialog.alert("提示: ",data,status)})};dao.noperceptionAdd=function($scope){var customerId=defaultString($scope.customerId);var cascadeLabel="";if(customerId){var customerArr=customerId.split("#");customerId=customerArr[0];cascadeLabel=customerArr[1]}var time=0;var type=defaultString($scope.dateType);if(type=="1"){time=$scope.timeH}else if(type=="2"){time=$scope.timeD}var params={customerId:customerId,cascadeLabel:cascadeLabel,dateType:type,time:time,remark:defaultString($scope.remark)};var url="/noperception/add?"+$.param(params);$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}jDialog.alert("添加无感应","添加无感应成功！");$location.path("noperception/list")}).error(function(data,status,headers,config){jDialog.alert("提示: ",data,status)})};dao.noperceptionEdit=function($scope,id){var time=0;var type=defaultString($scope.dateType);if(type=="1"){time=$scope.timeH}else if(type=="2"){time=$scope.timeD}var params={id:id,customerId:$scope.customerId,cascadeLabel:$scope.cascadeLabel,dateType:type,time:time,remark:defaultString($scope.remark),status:$scope.status};var url="/noperception/edit?"+$.param(params);$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}jDialog.alert("编辑无感应","编辑无感应成功！");$location.path("noperception/list")}).error(function(data,status,headers,config){jDialog.alert("提示: ",data,status)})};dao.noperceptionShow=function($scope,id){var url="/noperception/show?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}var _data=data.data;$scope.customerId=_data.customerId;$scope.cascadeLabel=_data.cascadeLabel;$scope.customerName=_data.customerName;$scope.remark=_data.remark;$scope.dateType=_data.dateType;$scope.time=_data.time;$scope.timeDsp=_data.timeDsp;$scope.status=_data.status;$scope.statusDsp=_data.statusDsp;$scope.unit=_data.unit;var dateType=_data.dateType;var time=_data.time;if(dateType==1){$scope.timeH=time}else if(dateType==2){$scope.timeD=time}}).error(function(data,status,headers,config){jDialog.alert("提示: ",data,status)})};dao.noperceptionOpen=function($scope,ids){var params={id:ids,status:"1"};var url="/noperception/open?"+$.param(params);$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}jDialog.alert("开启无感应","批量开启无感应成功！");$scope.list();$(':checkbox[name="checkboxAll"]').prop("checked",false)}).error(function(data,status,headers,config){
jDialog.alert("提示: ",data,status)})};dao.noperceptionClose=function($scope,ids){var params={id:ids,status:"2"};var url="/noperception/open?"+$.param(params);$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}jDialog.alert("关闭无感应","批量关闭无感应成功！");$scope.list();$(':checkbox[name="checkboxAll"]').prop("checked",false)}).error(function(data,status,headers,config){jDialog.alert("提示: ",data,status)})};return dao});indexApp.factory("themeDao",function($http,$location,pageDao){var dao={};dao.themeSelectList=function($scope){var url="/theme/findbyname";$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.themes=data.records})};dao.themeStrategyList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var customerIdAndLevel=defaultString($scope.customerIdAndLevel);var customerIdAndLevelArray=customerIdAndLevel.split("#");var customerId=customerIdAndLevelArray[0];var cascadeLabel=customerIdAndLevelArray[1];var themeId=defaultString($scope.themeId);var themeType=defaultString($scope.themeType);var content=defaultString($scope.content);if(isBlank(customerId)){customerId=""}if(isBlank(cascadeLabel)){cascadeLabel=""}if(isBlank(themeId)){themeId=""}if(isBlank(themeType)){themeType=""}content=encodeURIComponent(content);var url="/themestrategy/list?pageNo="+pageNo+"&customerId="+customerId+"&cascadeLabel="+cascadeLabel+"&themeId="+themeId+"&themeType="+themeType+"&content="+content;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.themeStrategys=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.deleteStrategy=function($scope,id){var url="/themestrategy/delete?id="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.alert("皮肤策略删除：","删除成功！");$scope.list()})};dao.themeStrategyAdd=function($scope){$("#themeStrategyAdd").attr("disabled",true);var customerIdAndLevel=defaultString($scope.themeStrategy.customerIdAndLevel);var customerIdAndLevelArray=customerIdAndLevel.split("#");var customerId=customerIdAndLevelArray[0];var cascadeLabel=customerIdAndLevelArray[1];var themeId=$scope.themeStrategy.themeId;var themeType=$scope.themeStrategy.themeType;var content=defaultString($scope.themeStrategy.content);var remark=defaultString($scope.themeStrategy.remark);if(isBlank(themeId)){themeId=""}if(isBlank(themeType)){themeType=""}content=encodeURIComponent(content);remark=encodeURIComponent(remark);var url="/themestrategy/add?customerId="+customerId+"&cascadeLabel="+cascadeLabel+"&themeId="+themeId+"&themeType="+themeType+"&content="+content+"&remark="+remark;$http.post(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);$("#themeStrategyAdd").removeAttr("disabled");return}jDialog.alert("新增皮肤策略:","保存成功");$location.path("themeStrategy/list")})};dao.themeStrategyById=function($scope,id){var url="/themestrategy/show?id="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.themeStrategy=data.data;var themeType=$scope.themeStrategy.themeType;if(themeType=="1"){$("#themeType1").attr("selected",true)}else if(themeType=="2"){$("#themeType2").attr("selected",true)}})};dao.themeStrategyEdit=function($scope){$("#themeStrategyEdit").attr("disabled",true);var customerId=$scope.themeStrategy.customerId;var cascadeLabel=$scope.themeStrategy.cascadeLabel;var id=$scope.themeStrategy.id;var themeId=$scope.themeStrategy.themeId;var themeType=$("#themeType").val();var content=defaultString($scope.themeStrategy.content);var remark=defaultString($scope.themeStrategy.remark);if(isBlank(themeId)){themeId=""}if(isBlank(themeType)){themeType=""}content=encodeURIComponent(content);remark=encodeURIComponent(remark);var url="/themestrategy/edit?id="+id+"&customerId="+customerId+"&cascadeLabel="+cascadeLabel+"&themeId="+themeId+"&themeType="+themeType+"&content="+content+"&remark="+remark;$http.post(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);$("#themeStrategyEdit").removeAttr("disabled");return}jDialog.alert("编辑皮肤策略:","保存成功");$location.path("themeStrategy/list")})};dao.themeList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var name=defaultString($scope.name);name=encodeURIComponent(name);var url="/theme/list?pageNo="+pageNo+"&name="+name;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.themes=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.deleteTheme=function($scope,id){var url="/theme/delete?id="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.alert("皮肤删除：","删除成功！");$scope.list()})};dao.themeAdd=function($scope){$("#themeAdd").attr("disabled",true);var name=defaultString($scope.theme.name);var version=defaultString($scope.theme.version);var remark=defaultString($scope.theme.remark);name=encodeURIComponent(name);version=encodeURIComponent(version);remark=encodeURIComponent(remark);var url="/theme/add?name="+name+"&version="+version+"&remark="+remark;var options={url:url,type:"post",dataType:"json",clearForm:false,resetForm:false,beforeSubmit:function(){return true},success:function(data){if(data.result=="FAIL"){$("#themeAdd").attr("disabled",false);jDialog.alert("提示:",data.message);return}jDialog.alert("新增皮肤:","保存成功");$location.path("/theme/list");$scope.$apply()}};$("#themeAddForm").ajaxSubmit(options)};dao.themeById=function($scope,id){var url="/theme/show?id="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}$scope.theme=data.data})};dao.themeEdit=function($scope){$("#themeEdit").attr("disabled",true);var name=defaultString($scope.theme.name);var version=defaultString($scope.theme.version);var remark=defaultString($scope.theme.remark);name=encodeURIComponent(name);version=encodeURIComponent(version);remark=encodeURIComponent(remark);var url="/theme/edit?name="+name+"&version="+version+"&remark="+remark;var options={url:url,type:"post",dataType:"json",clearForm:false,resetForm:false,beforeSubmit:function(){return true},success:function(data){if(data.result=="FAIL"){$("#themeEdit").attr("disabled",false);jDialog.alert("提示:",data.message);return}jDialog.alert("编辑皮肤:","保存成功");$location.path("/theme/list");$scope.$apply()}};$("#themeEditForm").ajaxSubmit(options)};return dao});indexApp.factory("industryService",function($rootScope,industryDao){var service={};service.industry1List=function($scope){industryDao.industry1List($scope)};service.industry2List=function($scope,industryId1){$scope.industry2s="";if(isBlank(industryId1)){return}industryDao.industry2List($scope,industryId1)};return service});indexApp.factory("locationService",function($rootScope,locationDao){var service={};service.provinceList=function($scope){locationDao.provinceList($scope)};service.cityList=function($scope,provinceId){if(provinceId===null||provinceId===""||provinceId==="undefined"){$scope.citys="";$scope.countys="";return}locationDao.cityList($scope,provinceId)};service.countyList=function($scope,cityId){if(cityId===null||cityId===""||cityId==="undefined"){$scope.countys="";return}locationDao.countyList($scope,cityId)};return service});indexApp.factory("noperceptionService",function($rootScope,noperceptionDao){var service={};function validateCustomerNameFail($scope){var $customerName=$("#customerName");var jihe=defaultString($scope.customerId);var jiheArray=jihe.split("#");var customerName=jiheArray[2];if(isBlank(customerName)){updateShowTipos($customerName,"客户名称不能为空！");return true}return false}function validateDateTypeFail($scope){var dateType=$scope.dateType;var $dateTypeH=$("#dateTypeH");var $dateTypeD=$("#dateTypeD");if(dateType==1){if(isBlank($scope.timeH)){updateShowTipos($dateTypeH,"请输入时长");return true}var timeH=null;if(!/^\d+\.?\d*$/.test($scope.timeH)){updateShowTipos($dateTypeH,"请输入有效时长（数字）");return true}timeH=parseFloat($scope.timeH);if(!(timeH>=.5&&timeH<=23.5&&timeH%.5==0)){updateShowTipos($dateTypeH,"请输入0.5的倍数且不能超过24小时的时间");return true}}if(dateType==2){if(isBlank($scope.timeD)){updateShowTipos($dateTypeD,"请输入天数");return true}if(!/^[1-9]\d*$/.test($scope.timeD)){updateShowTipos($dateTypeD,"请输入大于等于1天的自然天数字");return true}}return false}service.initTips=function(){var $customerName=$("#customerName");var $dateTypeH=$("#dateTypeH");var $dateTypeD=$("#dateTypeD");initTipsArray([$customerName,$dateTypeH,$dateTypeD]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$customerName,$dateTypeH,$dateTypeD])})};service.validateNoperceptionFail=function($scope,action){action=action||"edit";if(action==="add"&&validateCustomerNameFail($scope)){return true}if(validateDateTypeFail($scope)){return true}};service.noperceptionList=noperceptionDao.noperceptionList;service.noperceptionAdd=noperceptionDao.noperceptionAdd;service.noperceptionEdit=noperceptionDao.noperceptionEdit;service.noperceptionShow=noperceptionDao.noperceptionShow;service.noperceptionOpen=noperceptionDao.noperceptionOpen;service.noperceptionClose=noperceptionDao.noperceptionClose;return service});indexApp.factory("themeService",function($rootScope,themeDao){var service={};service.validateCustomerIdAndLevelForThemeStrategyFail=function($scope){var $customerIdAndLevel=$("#customerIdAndLevel");var customerIdAndLevel=$scope.themeStrategy.customerIdAndLevel;if(isBlank(customerIdAndLevel)){updateShowTipos($customerIdAndLevel,"请选择一个客户！");return true}return false};service.validateThemeIdForThemeStrategyFail=function($scope){var $themeId=$("#themeId");var themeId=$scope.themeStrategy.themeId;if(isBlank(themeId)){updateShowTipos($themeId,"请选择一个皮肤");return true}return false};service.validateThemeTypeForThemeStrategyFail=function($scope){var $themeType=$("#themeType");var themeType=$themeType.val();if(isBlank(themeType)){updateShowTipos($themeType,"请选择一个类别");return true}return false};service.validateContentForThemeStrategyFail=function($scope){var themeType=$("#themeType").val();var $content=$("#content");var content=$scope.themeStrategy.content;if(isBlank(content)){updateShowTipos($content,"内容不能为空");return true}if(themeType=="1"){if(!chkString(content,defrules.domain)){updateShowTipos($content,"当前类别为域名，请输入符合域名要求的内容");return true}}else if(themeType=="2"){if(!chkString(content,defrules.typeCode)){updateShowTipos($content,"当前类别为编码，请输入1-20位字母、数字");return true}}return false};service.initTipsForThemeStrategyChange=function(){var $customerIdAndLevel=$("#customerIdAndLevel");var $themeId=$("#themeId");var $themeType=$("#themeType");var $content=$("#content");initTipsArray([$customerIdAndLevel,$themeId,$themeType,$content]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$customerIdAndLevel,$themeId,$themeType,$content])})};service.validateNameForThemeFail=function($scope){var $name=$("#name");var name=$scope.theme.name;if(isBlank(name)){updateShowTipos($name,"皮肤名称不能为空");return true}return false};service.validateVersionForThemeFail=function($scope){var $version=$("#version");var version=$scope.theme.version;if(isBlank(version)){updateShowTipos($version,"版本号不能为空");return true}return false};service.validateThumbPicForThemeFail=function($scope){var $thumbPic=$("#thumbPic");var thumbPic=$thumbPic.val();if(isBlank(thumbPic)){updateShowTipos($thumbPic,"缩略图不能为空");return true}var isPic=thumbPic.indexOf(".png")!=-1||thumbPic.indexOf(".jpg")!=-1;if(!isPic){updateShowTipos($thumbPic,"缩略图格式不正确，格式要求：png或jpg图片");return true}return false};service.validateThumbPicForThemeOfEditFail=function($scope){var $thumbPic=$("#thumbPic");var thumbPic=$thumbPic.val();var isPic=thumbPic.indexOf(".png")!=-1||thumbPic.indexOf(".jpg")!=-1;if(isNotBlank(thumbPic)&&!isPic){updateShowTipos($thumbPic,"缩略图格式不正确，格式要求：png或jpg图片");return true}return false};service.validateThemeZipForThemeFail=function($scope){var $themeZip=$("#themeZip");var themeZip=$themeZip.val();if(isBlank(themeZip)){updateShowTipos($themeZip,"皮肤压缩包不能为空");return true}if(themeZip.indexOf(".zip")==-1){updateShowTipos($themeZip,"皮肤压缩包不正确，格式要求：zip");return true}return false};service.validateThemeZipForThemeOfEditFail=function($scope){var $themeZip=$("#themeZip");var themeZip=$themeZip.val();if(isNotBlank(themeZip)&&themeZip.indexOf(".zip")==-1){updateShowTipos($themeZip,"组件压缩包格式不正确，格式要求：zip！");return true}return false};service.initTipsForThemeChange=function(){var $name=$("#name");var $version=$("#version");var $thumbPic=$("#thumbPic");var $themeZip=$("#themeZip");initTipsArray([$name,$version,$thumbPic,$themeZip]);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray([$name,$version,$thumbPic,$themeZip])})};service.themeSelectList=function($scope){themeDao.themeSelectList($scope)};service.themeStrategyList=function($scope){themeDao.themeStrategyList($scope)};service.deleteStrategy=function($scope,id){themeDao.deleteStrategy($scope,id)};service.themeStrategyAdd=function($scope){themeDao.themeStrategyAdd($scope)};service.themeStrategyById=function($scope,id){themeDao.themeStrategyById($scope,id)};service.themeStrategyEdit=function($scope){themeDao.themeStrategyEdit($scope)};service.themeList=function($scope){themeDao.themeList($scope)};service.deleteTheme=function($scope,id){themeDao.deleteTheme($scope,id)};service.themeAdd=function($scope){themeDao.themeAdd($scope)};service.themeById=function($scope,id){themeDao.themeById($scope,id)};service.themeEdit=function($scope){themeDao.themeEdit($scope)};return service});